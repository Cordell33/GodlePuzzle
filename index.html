
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>G√∂dle</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #121212;
      color: #eee;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      margin: 0;
      min-height: 100vh;
      transition: background 0.3s ease, color 0.3s ease;
      color-scheme: dark;
    }
    body.light-mode {
      background: #f6f7f9;
      color: #1b1b1b;
      color-scheme: light;
    }
    h1 { 
      font-size: 2.8rem; 
      margin-bottom: 1rem; 
      color: #00bcd4;
      text-shadow: 0 0 10px rgba(0, 188, 212, 0.5);
    }
    .game-area {
      display: flex;
      align-items: flex-start;
      gap: 2rem;
      flex-wrap: wrap;
      justify-content: center;
      margin: 1rem 0;
    }
    .rules-card {
      width: 100%;
      max-width: 700px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 1.5rem 2rem;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.35);
      margin: 0 0 1.5rem;
      transition: background 0.3s ease, box-shadow 0.3s ease;
    }
    .rules-card h2 {
      margin-top: 0;
      margin-bottom: 0.75rem;
      font-size: 1.6rem;
      color: #00bcd4;
      text-shadow: 0 0 8px rgba(0, 188, 212, 0.4);
    }
    .rules-card p {
      margin-top: 0;
      margin-bottom: 0.75rem;
      color: #ddd;
      line-height: 1.5;
      transition: color 0.3s ease;
    }
    .rules-card ul {
      margin: 0;
      padding-left: 1.3rem;
      color: #ccc;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      font-size: 1.05rem;
      transition: color 0.3s ease;
    }
    .rules-card ul b {
      color: #fff;
    }
    .questions { 
      font-size: 1.2rem; 
      min-width: 280px; 
      display: flex; 
      flex-direction: column; 
      gap: 1rem; 
    }
    .question-container { 
      display: flex; 
      align-items: center; 
      gap: 0.5rem; 
    }
    .question-text {
      background-color: #333;
      border-left: 4px solid #00bcd4;
      padding: 0.8rem;
      font-weight: bold;
      border-radius: 4px;
      flex-grow: 1;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      transition: background-color 0.3s ease, box-shadow 0.3s ease, color 0.3s ease;
    }
    .question-result {
      font-size: 1.8rem;
      min-width: 40px;
      text-align: center;
    }
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    .hint-text {
      background-color: #333;
      border-left: 4px solid #ff9800;
      padding: 0.8rem;
      font-style: italic;
      border-radius: 4px;
      margin-top: 1rem;
      display: none;
      animation: fadeIn 0.5s ease-in;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .guesses { 
      display: flex; 
      flex-direction: column; 
      align-items: flex-start; 
      width: 100%; 
      max-width: 20rem; 
    }
    .row { 
      display: flex; 
      margin: 0.5rem 0; 
      justify-content: flex-start; 
      align-items: center; 
    }
    .cell { 
      width: 3rem; 
      height: 3rem; 
      font-size: 1.5rem; 
      margin: 0.2rem; 
      text-align: center; 
      border: 2px solid #444; 
      border-radius: 8px; 
      background: #222; 
      color: white;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    .cell:focus {
      outline: none;
      border-color: #00bcd4;
      box-shadow: 0 0 10px rgba(0, 188, 212, 0.5);
    }
    .cell.green { 
      background: #2ecc71; 
      border-color: #27ae60;
      transform: scale(1.05);
    }
    .cell.yellow { 
      background: #f39c12; 
      border-color: #d35400;
      transform: scale(1.05);
    }
    .cell.gray { 
      background: #7f8c8d; 
      border-color: #636e72;
    }
    /* Final code row gets a red border */
    .row.final-code .cell {
      border: 2px solid #27ae60;
      box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
    }

    #submit, #hint-button { 
      margin-top: 1.5rem; 
      padding: 0.8rem 1.5rem; 
      font-size: 1.1rem; 
      width: 100%; 
      max-width: 300px; 
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    #submit {
      background: #00bcd4;
      color: white;
    }
    #submit:hover {
      background: #0097a7;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    #hint-button {
      background: #ff9800;
      color: white;
    }
    #hint-button:hover {
      background: #f57c00;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    #game-over {
      margin-top: 1.5rem;
      font-size: 1.5rem;
      text-align: center;
      padding: 1rem;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.1);
      animation: fadeIn 0.5s ease-in;
      display: none; /* hidden until end */
      transition: background 0.3s ease, color 0.3s ease;
    }
    #menu-toggle {
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 1100;
      background: #00bcd4;
      color: #121212;
      border: none;
      border-radius: 999px;
      padding: 0.55rem 1.1rem;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      transition: background 0.2s ease, transform 0.2s ease;
    }
    #menu-toggle:hover {
      background: #00a0b7;
      transform: translateY(-1px);
    }
    body.menu-open #menu-toggle {
      background: #0097a7;
      color: #fff;
    }
    #menu-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 1000;
    }
    body.menu-open #menu-backdrop {
      opacity: 1;
      pointer-events: auto;
    }
    #side-menu {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: min(320px, 85vw);
      background: #1b1b1b;
      box-shadow: 8px 0 24px rgba(0, 0, 0, 0.45);
      transform: translateX(-100%);
      transition: transform 0.3s ease, background 0.3s ease, box-shadow 0.3s ease, color 0.3s ease;
      z-index: 1050;
      padding: 1.5rem 1.75rem 2rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      overflow-y: auto;
    }
    body.menu-open #side-menu {
      transform: translateX(0);
    }
    #side-menu h2 {
      margin: 0;
      color: #00bcd4;
      font-size: 1.5rem;
      text-shadow: 0 0 8px rgba(0, 188, 212, 0.4);
    }
    #side-menu p {
      margin: 0;
      color: #ddd;
      line-height: 1.4;
      transition: color 0.3s ease;
    }
    .login-panel {
      margin-top: 1.5rem;
      background: rgba(255, 255, 255, 0.05);
      padding: 1rem 1.5rem;
      border-radius: 12px;
      max-width: 420px;
      width: 100%;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.25);
      transition: background 0.3s ease, box-shadow 0.3s ease;
    }
    .login-panel label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    .login-row {
      display: flex;
      gap: 0.5rem;
    }
    .login-panel input[type="text"] {
      flex: 1;
      padding: 0.6rem 0.8rem;
      border-radius: 8px;
      border: 1px solid #444;
      background: #1e1e1e;
      color: #fff;
      font-size: 1rem;
      transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }
    .login-panel input[type="text"]:focus {
      outline: none;
      border-color: #00bcd4;
      box-shadow: 0 0 0 3px rgba(0, 188, 212, 0.2);
    }
    .login-panel button {
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      border: none;
      background: #00bcd4;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .login-panel button:hover {
      background: #0097a7;
    }
    .login-panel .external-link {
      margin-top: 0.75rem;
      display: block;
      color: #00bcd4;
      font-weight: 600;
      text-decoration: none;
      transition: color 0.2s ease;
    }
    .login-panel .external-link:hover {
      color: #ff9800;
      text-decoration: underline;
    }
    #logout-button {
      margin-top: 0.75rem;
      width: 100%;
      background: #ef5350;
    }
    #logout-button:hover {
      background: #e53935;
    }
    .login-hint {
      margin-top: 0.75rem;
      font-size: 0.9rem;
      color: #ccc;
      transition: color 0.3s ease;
    }
    #timer {
      margin-top: 1rem;
      font-size: 1.3rem;
      color: #00bcd4;
      font-weight: bold;
    }
    #stars { 
      margin-top: 1rem; 
      font-size: 1.8rem; 
      color: gold;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }
    .share-buttons {
      display: flex;
      gap: 0.75rem;
      margin-top: 1.5rem;
      justify-content: center;
      flex-wrap: wrap;
    }
    .share-button {
      border: none;
      padding: 0.6rem 1.4rem;
      border-radius: 999px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: #1f1f1f;
      color: #fff;
      font-weight: 600;
      font-size: 1rem;
      letter-spacing: 0.02em;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease, color 0.2s ease;
    }
    .share-button:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 12px 22px rgba(0, 0, 0, 0.25);
    }
    .share-button:focus-visible {
      outline: 3px solid rgba(255, 255, 255, 0.6);
      outline-offset: 2px;
    }
    .share-button.twitter { background: #1DA1F2; }
    .share-button.facebook { background: #0866FF; }
    .share-button.reddit { background: #FF4500; }
    .share-button.bluesky { background: #0A66FF; }
    .share-button.copy { background: #333; }
    #copy-message { 
      margin-top: 1rem; 
      color: #00bcd4; 
      display: none;
      animation: fadeIn 0.5s ease-in;
    }
    #share-results { 
      margin-top: 2rem; 
      display: none; 
      text-align: center;
      animation: fadeIn 0.5s ease-in;
    }
    footer {
      margin-top: 3rem;
      font-size: 0.9rem;
      color: #777;
      text-align: center;
      padding: 1.5rem;
      border-top: 1px solid #333;
      width: 100%;
      max-width: 600px;
      transition: color 0.3s ease, border-color 0.3s ease;
    }
    footer a {
      color: #00bcd4;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    footer a:hover {
      color: #ff9800;
      text-decoration: underline;
    }

    .theme-toggle {
      margin-top: auto;
      padding-top: 1.25rem;
      border-top: 1px solid rgba(255, 255, 255, 0.12);
    }
    .toggle-control {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      font-weight: 600;
      color: #ddd;
      cursor: pointer;
      user-select: none;
      position: relative;
    }
    .toggle-control input {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }
    .toggle-control .switch {
      width: 48px;
      height: 26px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.3);
      position: relative;
      transition: background 0.3s ease;
      flex-shrink: 0;
    }
    .toggle-control .switch::after {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
      transition: transform 0.3s ease;
    }
    .toggle-control input:checked + .switch {
      background: #00bcd4;
    }
    .toggle-control input:checked + .switch::after {
      transform: translateX(22px);
    }
    .toggle-control input:focus-visible + .switch {
      box-shadow: 0 0 0 3px rgba(0, 188, 212, 0.45);
    }

    body.light-mode .rules-card {
      background: rgba(0, 0, 0, 0.05);
      box-shadow: 0 10px 24px rgba(31, 64, 79, 0.15);
    }
    body.light-mode .rules-card p {
      color: #2d2d2d;
    }
    body.light-mode .rules-card ul {
      color: #3b3b3b;
    }
    body.light-mode .rules-card ul b {
      color: #000;
    }
    body.light-mode .question-text {
      background-color: #eef3f7;
      color: #1b1b1b;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12);
    }
    body.light-mode .hint-text {
      background-color: #fff3e0;
      color: #5c3b00;
    }
    body.light-mode .cell {
      background: #ffffff;
      color: #111;
      border-color: #c3c8d0;
    }
    body.light-mode .cell.green {
      background: #66bb6a;
      border-color: #43a047;
      color: #0b2f16;
    }
    body.light-mode .cell.yellow {
      background: #ffd54f;
      border-color: #ffb300;
      color: #5a4100;
    }
    body.light-mode .cell.gray {
      background: #cfd8dc;
      border-color: #b0bec5;
    }
    body.light-mode .cell:focus {
      border-color: #00a0b7;
      box-shadow: 0 0 10px rgba(0, 160, 183, 0.4);
    }
    body.light-mode #side-menu {
      background: #fdfdfd;
      box-shadow: 8px 0 24px rgba(0, 0, 0, 0.1);
      color: #1f1f1f;
    }
    body.light-mode #side-menu p {
      color: #444;
    }
    body.light-mode .login-panel {
      background: rgba(0, 0, 0, 0.05);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.12);
    }
    body.light-mode .login-panel input[type="text"] {
      background: #fff;
      color: #111;
      border-color: #b8bec6;
    }
    body.light-mode .login-panel input[type="text"]::placeholder {
      color: #757575;
    }
    body.light-mode .login-panel input[type="text"]:focus {
      box-shadow: 0 0 0 3px rgba(0, 160, 183, 0.25);
    }
    body.light-mode .login-hint {
      color: #555;
    }
    body.light-mode #game-over {
      background: rgba(0, 0, 0, 0.06);
      color: #1b1b1b;
    }
    body.light-mode footer {
      color: #555;
      border-top: 1px solid #d4d4d4;
    }
    body.light-mode .share-button.copy {
      background: #f0f2f5;
      color: #1e1e1e;
    }
    body.light-mode .share-button.copy:hover {
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.18);
    }
    body.light-mode .theme-toggle {
      border-top: 1px solid rgba(0, 0, 0, 0.12);
    }
    body.light-mode .toggle-control {
      color: #2c2c2c;
    }
    body.light-mode .toggle-control .switch {
      background: rgba(0, 0, 0, 0.2);
    }
    body.light-mode .toggle-control input:checked + .switch {
      background: #0097a7;
    }
    body.light-mode .toggle-control .switch::after {
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }
    @media (max-width: 600px) {
      body { padding: 1rem; }
      .cell { width: 2.8rem; height: 2.8rem; font-size: 1.3rem; }
      .game-area { flex-direction: column; align-items: center; }
      .questions { min-width: 100%; }
      h1 { font-size: 2.2rem; }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background-color: #f39c12;
      opacity: 0.7;
      animation: confetti-fall 5s linear forwards;
      z-index: 1000;
    }
    
    @keyframes confetti-fall {
      0% {
        transform: translateY(-100px) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <button id="menu-toggle" type="button" aria-expanded="false" aria-controls="side-menu" aria-label="Open game menu">‚ò∞ Menu</button>
  <div id="menu-backdrop" role="presentation"></div>
  <aside id="side-menu" aria-hidden="true" tabindex="-1">
    <h2>Game Menu</h2>
    <p>Sign in to track your streak, then use the Start Game button below the board whenever you're ready to play.</p>
    <div class="login-panel" aria-live="polite">
      <form id="login-form">
        <label for="username-input">Player username</label>
        <div class="login-row">
          <input id="username-input" name="username" type="text" placeholder="Enter username" autocomplete="nickname" required />
          <button type="submit" id="login-button">Log In</button>
        </div>
      </form>
      <button id="logout-button" type="button" style="display: none;">Log Out</button>
      <p class="login-hint">Your daily streak is saved per username on this device.</p>
      <a class="external-link" href="https://cordell33.github.io/GodleHex/" target="_blank" rel="noopener noreferrer">GodleHex (weekly)</a>
      <a class="external-link" href="https://cordell33.github.io/Cordlle/" target="_blank" rel="noopener noreferrer">Cordlle (monthly)</a>
    </div>
    <div class="theme-toggle">
      <label class="toggle-control" for="theme-toggle">
        <span>Light background</span>
        <input type="checkbox" id="theme-toggle" />
        <span class="switch" aria-hidden="true"></span>
      </label>
    </div>
  </aside>

  <div id="auth-bar" style="width:100%;max-width:680px;display:flex;justify-content:space-between;align-items:center;margin:0.5rem 0 0.25rem;">
    <div id="user-info">Guest</div>
    <div id="streak" title="Daily streak">üî• Guest play (streak not saved)</div>
  </div>

  <h1>G√∂dle</h1>

  <section class="rules-card" aria-labelledby="rules-heading">
    <h2 id="rules-heading">How to Play</h2>
    <p>Crack the daily code by solving quick logic and math prompts, then combine your answers to guess the final digits.</p>
    <ul>
      <li>Answer 4 questions using every digit (0-9) <b>exactly once</b>.</li>
      <li>Use your solutions as clues for the final 5-digit code.</li>
      <li><b>Green</b> = correct digit & position, <b>Yellow</b> = correct digit, wrong position.</li>
      <li>Beat the clock to earn bonus stars and share your results.</li>
      <li>Click <b>Start Game</b> below to begin, then <b>Submit Guess</b> for each row.</li>
    </ul>
  </section>

  <div id="timer">‚è± Time: 0:00</div>
  <div class="game-area">
    <div class="questions" id="questions"></div>
    <div class="guesses" id="guess-container"></div>
  </div>
  <button id="submit">Submit Guess</button>
  <button id="hint-button" style="display: none;">Hint</button>
  <div id="hint" class="hint-text"></div>
  <div id="stars"></div>
  <div id="game-over" aria-live="polite"></div>

  <div id="share-results">
    <h3>Share Your Results</h3>
    <div class="share-buttons">
      <button class="share-button twitter" type="button" onclick="shareTwitter()">
        Share on X (Twitter)
      </button>
      <button class="share-button facebook" type="button" onclick="shareFacebook()">
        Share on Facebook
      </button>
      <button class="share-button reddit" type="button" onclick="shareReddit()">
        Share on Reddit
      </button>
      <button class="share-button bluesky" type="button" onclick="shareBluesky()">
        Share on Bluesky
      </button>
      <button class="share-button copy" type="button" onclick="copyResults()">
        Copy Results
      </button>
    </div>
    <div id="copy-message" aria-live="polite">Copied to clipboard!</div>
  </div>

  <footer>created by Cordell Booth ‚Ä¢ <a href="https://patreon.com/GodleCreator" target="_blank">Donate</a> ‚Ä¢ <a href="https://www.facebook.com/groups/2109717096181882" target="_blank">Community</a></footer>

  <script>
    // ====== PUZZLE CONTENT ======

   const puzzleSchedule = [
    {
      releaseDate: "2025-12-04",
      questions: [
       "Any nonzero number to the 0 power equals ? (e.g., 5^0 = ?)",
       "4 twenties =  ?",
       "1300 ‚àí 1031 = ?",
       "3767 √ó 2 = ?",
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [1],
       [8, 0],
       [2, 6, 9],
       [7, 5, 3, 4],
       [1, 6, 9, 4, 0]
      ],
      hintText: "1, 80, 269, 7534.",
      code: [1, 6, 9, 4, 0]
    },
    {
      releaseDate: "2025-12-05",
      questions: [
       "18 √∑ 3 = ?",
       "7 √ó 12 = ?",
       "If f(x) = 13(x) -1, find f(10)",
       "1528 + 1529 = ?",
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [6],
       [8, 4],
       [1, 2, 9],
       [3, 0, 5, 7],
       [2, 4, 9, 7, 8]
      ],
      hintText: "6, 84, 129, 3057.",
      code: [2, 4, 9, 7, 8]
    },
    {
      releaseDate: "2025-12-06",
      questions: [
       "365 days equals this many years?",
       "37 √ó 2 = ?",
       "Find (x,y,z) given z = 3, y = 3z -1, y = x +8 ",
       "5912 √∑  2 = ?",
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [1],
       [7, 4],
       [0, 8, 3],
       [2, 9, 5, 6],
       [1, 7, 3, 6, 4]
      ],
      hintText: "1, 74, 083, 2956.",
      code: [1, 7, 3, 6, 4]
    },
    {
      releaseDate: "2025-12-07",
      questions: [
       "10 √∑ 10 = ?",
       "43 √ó 2 = ?",
       "1000 - 695 = ?",
       "4407 + 1207 + 3633 = ?",
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [1],
       [8, 6],
       [3, 0, 5],
       [9, 2, 4, 7],
       [3, 6, 5, 4, 7]
      ],
      hintText: "1, 86, 305, 9247.",
      code: [3, 6, 5, 4, 7]
    },
    {
      releaseDate: "2025-12-08",
      questions: [
       "27 √∑ 9 = ?",
       "7 x 10 = ?",
       "97 + 97 = ?",
       "6258 - 3124 + 3124 = ?",
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [3],
       [7, 0],
       [1, 9, 4],
       [6, 2, 5, 8],
       [6, 0, 4, 5, 8]
      ],
      hintText: "3, 70, 194, 6258.",
      code: [6, 0, 4, 5, 8]
    },
    {
      releaseDate: "2025-12-09",
      questions: [
       "27 √∑ 3 = ?",
       "7 x 9 = ?",
       "250 + 250 + 250?",
       " 0, __, 24, 36, __, 60 (in respective order)",
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [9],
       [6, 3],
       [7, 5, 0],
       [1, 2, 4, 8],
       [9, 5, 4, 0, 8]
      ],
      hintText: "9, 63, 750, 1248.",
      code: [9, 5, 4, 0, 8]
    },
    {
      releaseDate: "2025-12-10",
      questions: [
       "How many sides does an isoslese triangle have?",
       "If y = -3x + 7, find the y-intercept (x,y)",
       "200 ‚àí 6 = ?",
       "573 √ó 5 = ?",
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [3],
       [0, 7],
       [1, 9, 4],
       [2, 8, 6, 5],
       [3, 0, 4, 5, 9]
      ],
      hintText: "3, 07, 194, 2865.",
      code: [3, 0, 4, 5, 9]
    },
    {
      releaseDate: "2025-12-11",
      questions: [
       "How many deadly sins are there?",
       "If f(x)= 5x -2, find f(10)  ",
       "To turn in a complete circle",
       "259 x 5 = ?",
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [7],
       [4, 8],
       [3, 6, 0],
       [1, 2, 9, 5],
       [9, 6, 0, 5, 3]
      ],
      hintText: "7, 48, 360, 1295.",
      code: [9, 6, 0, 5, 3]
    },
    {
      releaseDate: "2025-12-12",
      questions: [
       "1 x 2 x 1 x 2 = ",
       "How many days til Christmas? ",
       "104  quintupled?",
       "13578 √∑ 2 = ?",
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [4],
       [1, 3],
       [5, 2, 0],
       [6, 7, 8, 9],
       [1, 2, 0, 4, 9]
      ],
      hintText: "4, 13, 520, 6789.",
      code: [1, 2, 0, 4, 9]
    },
    {
      releaseDate: "2025-12-13",
      questions: [
       "1 √ó 1 = ?",
       "60 + 10 = ?",
       "424 + 100 = ?",
       "4839 + 2000 = ?",
       "Enter the final 5-digit code",
      ],
      correctAnswers: [
       [1],
       [7, 0],
       [5, 2, 4],
       [6, 8, 3, 9],
       [7, 8, 4, 9, 1],
      ],
      hintText: "1, 70, 524, 6839.",
      code: [7, 8, 4, 9, 1]
    },
    {
      releaseDate: "2025-12-14",
      questions: [
       "This many blind mice in the popular nursery rhyme",
       "There are this many sets of 3600 seconds in a day",
       "79 + 79 = ?",
       "If x = 0, z = 9 +x, y +w = 13, w -y =1; find (x,y,w,z) ?",
       "Enter the final 5-digit code",
      ],
      correctAnswers: [
       [3],
       [2, 4],
       [1, 5, 8],
       [0, 6, 7, 9],
       [0, 1, 7, 9, 5],
      ],
      hintText: "3, 24, 158, 0679.",
      code: [0, 1, 7, 9, 5]
    },
    {
      releaseDate: "2025-12-15",
      questions: [
        "How many sides does a quadrilateral have?",
        "7 √ó 13 = ?",
        "300 ‚àí 30 = ?",
        "49 √ó 15 + 7000 -900= ?",
        "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [4],
       [9, 1],
       [2, 7, 0],
       [6, 8, 3, 5],
       [4, 9, 3, 5, 1]
      ],
      hintText: "4, 91, 268, 6835.",
      code: [4, 9, 3, 5, 1]
    },
    {
      releaseDate: "2025-12-16",
      questions: [
       "How many habitable continents are there",
       "111 √∑ 3 = ? ",
       "37 √ó 4 =  ?",
       " 5,2,0, -1, -1, _, _, _, _, 14",
       "Enter the final 5-digit code",
      ],
      correctAnswers: [
       [6],
       [3, 7],
       [1, 4, 8],
       [0, 2, 5, 9],
       [0, 7, 3, 9, 8],
      ],
      hintText: "6, 37, 148, 0259.",
      code: [0, 7, 3, 9, 8]
    },
    {
      releaseDate: "2025-12-17",
      questions: [
       "4 quarters equals this many dollars?",
       "1 dollar - 3 dimes + 3 pennies - 4 nickels in cents",
       "32% off 1000",
       "$73.37 with an 8% sales tax gives this total ($.__)?",
       "Enter the final 5-digit code",
      ],
      correctAnswers: [
       [1],
       [5, 3],
       [6, 8, 0],
       [7, 9, 2, 4],
       [1, 3, 0, 4, 8],
      ],
      hintText: "1, 53, 680, 7924.",
      code: [1, 3, 0, 4, 8]
    },
    {
      releaseDate: "2025-12-18",
      questions: [
       "0 -0 + 0 √ó 0 = ?",
       "13 √ó 7 =",
       "1920 √∑ 5 = ? ",
       "7(1000)-5(100)+ 3(10)-3",
       "Enter the final 5-digit code",
      ],
      correctAnswers: [
       [0],
       [9, 1],
       [3, 8, 4],
       [6, 5, 2, 7],
       [3, 5, 0, 7, 4],
      ],
      hintText: "0, 91, 384, 6527.",
      code: [3, 5, 0, 7, 4]
    },
    {
      releaseDate: "2025-12-19",
      questions: [
       "4 two times = ?",
       "Solve x(x-7) = 0, x= least to greatest",
       "100 + 43 = ?",
       "5269 √∑ 1 = ?",
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [8],
       [0, 7],
       [1, 4, 3],
       [5, 2, 6, 9],
       [1, 4, 8, 9, 3]
      ],
      hintText: "8, 07, 143, 5269.",
      code: [1, 4, 8, 9, 3]
    },
    {
      releaseDate: "2025-12-20",
      questions: [
       "3 √ó 3 = ?",
       "21 + 21 = ?",
       "190 + 190 + 190 + 190 = ?",
       "85310 √∑ 10 = ?",
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [9],
       [4, 2],
       [7, 6, 0],
       [8, 5, 3, 1],
       [2, 6, 0, 1, 7]
      ],
      hintText: "9, 42, 760, 8531.",
      code: [2, 6, 0, 1, 7]
    },
    {
      releaseDate: "2025-12-21",
      questions: [
       "21 √∑ 3 = ?",
       "What is 10 + 4?",
       "476 + 477 = ?",
       "4130 + 4130 = ?",
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [7],
       [1, 4],
       [9, 5, 3],
       [8, 2, 6, 0],
       [1, 9, 3, 0, 2]
      ],
      hintText: "7, 14, 953, 8260.",
      code: [1, 9, 3, 0, 2]
    },
    {
      releaseDate: "2025-12-22",
      questions: [
       "Corners on a trapezoid",
       "Days in February on a leap year",
       "1222 - 521 =  ?",
       "1 + 4326 √ó 2 = ?",
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [4],
       [2, 9],
       [7, 0, 1],
       [8, 6, 5, 3],
       [8, 0, 2, 3, 5]
      ],
      hintText: "4, 29, 701, 8653.",
      code: [8, 0, 2, 3, 5]
    },
    {
      releaseDate: "2025-12-23",
      questions: [
       "How many days til Christmas?",
       "How many days til Jan 7th (Orthodox Christmas)?",
       "123 √ó 3 = ?",
       "3647 + 1223 = ?",
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [2],
       [1, 5],
       [3, 6, 9],
       [4, 8, 7, 0],
       [3, 9, 7, 0, 5]
      ],
      hintText: "2, 15, 369, 4870.",
      code: [3, 9, 7, 0, 5]
    },
    {
      releaseDate: "2025-12-24",
      questions: [
       "How many reindeer does Santa have? (including Rudolph)",
       "How many is a dozen cookies?",
       "How many days til next Christmas Eve?",
       "12249 √∑ 3 + 4 = ?",
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [9],
       [1, 2],
       [3, 6, 5],
       [4, 0, 8, 7],
       [4, 2, 8, 7, 0]
      ],
      hintText: "9, 12, 365, 4087.",
      code: [4, 2, 8, 7, 0]
    },
    {
      releaseDate: "2025-12-25",
      questions: [
       "How many days til New Year‚Äôs day?",
       "How many weeks in a year?",
       "29 √ó 14 = ?",
       ".. 1, 2, 3, 5, 8, __, 21, 34, 55, __, 144..",
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [7],
       [5, 2],
       [4, 0, 6],
       [1, 3, 8, 9],
       [5, 2, 8, 3, 9]
      ],
      hintText: "7, 52, 406, 1389.",
      code: [5, 2, 8, 3, 9]
    },
    {
      releaseDate: "2025-12-26",
      questions: [
       "How many wheels does a standard bicycle have?",
       "29 √ó 2 = ?",
       "82 √ó 5 = ?",
       "4688 √ó 2 = ?",
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [2],
       [5, 8],
       [4, 1, 0],
       [9, 3, 7, 6],
       [0, 8, 7, 6, 4]
      ],
      hintText: "2, 58, 410, 9376.",
      code: [0, 8, 7, 6, 4]
    },
    {
      releaseDate: "2025-12-27",
      questions: [
       "2025 / 225 = ",
       "9 * 6 = ",
       "How many Bones in an adult human skeleton=",
       "1227 + 160 = ?" ,
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [9],
       [5, 4],
       [2, 0, 6],
       [1, 3, 8, 7],
       [3, 0, 8, 7, 5]
      ],
      hintText: "9,54,206,1387.",
      code: [3, 0, 8, 7, 5]
    },
    {
      releaseDate: "2025-12-28",
      questions: [
       "Days of the week",
       "125-36=",
       "Degrees in a circle",
       "_ _ _ - _ =121" ,
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [7],
       [8, 9],
       [3, 6, 0],
       [1, 2, 5, 4],
       [7, 9, 0, 4, 3]
      ],
      hintText: "7, 89, 360, 1254.",
      code: [7, 9, 0, 4, 3]
    },
    {
      releaseDate: "2025-12-29",
      questions: [
       "Colors in ROY G BIV",
       "2025-1989=",
       "1000/4",
       "Famous George Orwell book" ,
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [7],
       [3, 6],
       [2, 5, 0],
       [1, 9, 8, 4],
       [2, 6, 8, 0, 4]
      ],
      hintText: "7,36,250,1984.",
      code: [2, 6, 8, 0, 4]
    },
    {
      releaseDate: "2025-12-30",
      questions: [
       "Fingers on one hand üñêÔ∏è ",
       "Months in a year",
       "21 * 23 = ",
       "_ _ - 1 = _ _ " ,
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [5],
       [1, 2],
       [4, 8, 3],
       [7, 0, 6, 9],
       [4, 0, 3, 2, 9]
      ],
      hintText: "5,12,483,7069.",
      code: [4, 0, 3, 2, 9]
    },
    {
      releaseDate: "2025-12-31",
      questions: [
       "D is the ‚Äò_th‚Äô letter of the alphabet?",
       "A chinese zodiac cycle is __ years",
       "53 * 11 = ",
       "73. 72, 71, __, __, 68, 67 " ,
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [4],
       [1, 2],
       [5, 8, 3],
       [7, 0, 6, 9],
       [3, 0, 6, 9, 4]
      ],
      hintText: "4,12,583,7069.",
      code: [3, 0, 6, 9, 4]
    },
    {
      releaseDate: "2026-01-01",
      questions: [
       "1 √ó 1 = ?",
       "8 √ó 9 = ?",
       "103 √ó 3 = ?",
       "4327 √ó 2 = ?",
       "Enter the final 5-digit code"
      ],
      correctAnswers: [
       [1],
       [7, 2],
       [3, 0, 9],
       [8, 6, 5, 4],
       [0, 2, 9, 4, 7]
      ],
      hintText: "1, 72, 309, 8654.",
      code: [0, 2, 9, 4, 7]
    }
   ].sort((a, b) => a.releaseDate.localeCompare(b.releaseDate));

   const pyramid = [1, 2, 3, 4, 5];
   let questions = [];
   let correctAnswers = [];
   let hintText = "";
   let code = [];
   let activePuzzleReleaseDate = null;
   let nextScheduledReleaseDate = null;
   let releaseTimerId = null;

   function applyPuzzleData(puzzle) {
     questions = puzzle.questions;
     correctAnswers = puzzle.correctAnswers;
     hintText = puzzle.hintText;
     code = [...puzzle.code];
   }

   function getEasternDateParts(date = new Date()) {
     const formatter = new Intl.DateTimeFormat("en-US", {
       timeZone: "America/New_York",
       year: "numeric",
       month: "2-digit",
       day: "2-digit",
       hour: "2-digit",
       minute: "2-digit",
       second: "2-digit",
       hour12: false
     });
     const parts = formatter.formatToParts(date);
     const result = {};
     parts.forEach(({ type, value }) => {
       if (type !== "literal") {
         result[type] = value;
       }
     });
     return result;
   }

   function getEasternDateString(date = new Date()) {
     const { year, month, day } = getEasternDateParts(date);
     return `${year}-${month}-${day}`;
   }

   function getEasternOffsetMinutes(date) {
     const formatter = new Intl.DateTimeFormat("en-US", {
       timeZone: "America/New_York",
       hour: "2-digit",
       minute: "2-digit",
       hour12: false,
       timeZoneName: "shortOffset"
     });
     const parts = formatter.formatToParts(date);
     const tzName = parts.find((part) => part.type === "timeZoneName")?.value || "GMT-4";
     const match = tzName.match(/GMT([+-])(\d{1,2})(?::(\d{2}))?/);
     if (!match) {
       return -4 * 60;
     }
     const sign = match[1] === "-" ? -1 : 1;
     const hours = Number(match[2]);
     const minutes = match[3] ? Number(match[3]) : 0;
     return sign * (hours * 60 + minutes);
   }

   function getEasternMidnightUtcTimestamp(dateString) {
     const [year, month, day] = dateString.split("-").map(Number);
     const referenceDate = new Date(Date.UTC(year, month - 1, day, 12, 0, 0));
     const offsetMinutes = getEasternOffsetMinutes(referenceDate);
     return Date.UTC(year, month - 1, day, 0, 0, 0) - offsetMinutes * 60 * 1000;
   }

   function getActivePuzzle(date = new Date()) {
     const currentEasternDate = getEasternDateString(date);
     let selectedPuzzle = puzzleSchedule[0];
     for (const puzzle of puzzleSchedule) {
       if (puzzle.releaseDate <= currentEasternDate) {
         selectedPuzzle = puzzle;
       } else {
         break;
       }
     }
     const upcomingPuzzle = puzzleSchedule.find((puzzle) => puzzle.releaseDate > currentEasternDate);
     return {
       puzzle: selectedPuzzle,
       nextReleaseDate: upcomingPuzzle ? upcomingPuzzle.releaseDate : null
     };
   }

   const MAX_TIMEOUT_MS = 2147483647;

   function scheduleNextReleaseCheck(nextReleaseDate) {
     if (releaseTimerId) {
       clearTimeout(releaseTimerId);
       releaseTimerId = null;
     }
     if (!nextReleaseDate) {
       return;
     }
     const targetUtc = getEasternMidnightUtcTimestamp(nextReleaseDate);
     const delay = targetUtc - Date.now();
     const safeDelay = delay > 0 ? Math.min(delay, MAX_TIMEOUT_MS) : 0;
     releaseTimerId = setTimeout(() => {
       releaseTimerId = null;
       handlePuzzleRelease();
     }, safeDelay);
   }

   function handlePuzzleRelease() {
     const { puzzle, nextReleaseDate } = getActivePuzzle();
     if (puzzle.releaseDate !== activePuzzleReleaseDate) {
       applyPuzzleData(puzzle);
       activePuzzleReleaseDate = puzzle.releaseDate;
       const wasActive = gameActive;
       initGame();
       if (wasActive) {
         gameActive = false;
         submitBtn.textContent = "Start Game";
       }
     }
     nextScheduledReleaseDate = nextReleaseDate;
     scheduleNextReleaseCheck(nextScheduledReleaseDate);
   }

   const { puzzle: initialPuzzle, nextReleaseDate: initialNextReleaseDate } = getActivePuzzle();
   applyPuzzleData(initialPuzzle);
   activePuzzleReleaseDate = initialPuzzle.releaseDate;
   nextScheduledReleaseDate = initialNextReleaseDate;


    // ====== GAME STATE & DOM ======
    let currentStep = 0;
    const questionsDiv = document.getElementById("questions");
    const guessContainer = document.getElementById("guess-container");
    const submitBtn = document.getElementById("submit"); // FIX: define before use
    const hintBtn = document.getElementById("hint-button");
    const gameOverDiv = document.getElementById("game-over");
    const starsDiv = document.getElementById("stars");
    const menuToggle = document.getElementById("menu-toggle");
    const menuBackdrop = document.getElementById("menu-backdrop");
    const sideMenu = document.getElementById("side-menu");
    const timerDiv = document.getElementById("timer");
    const hintDiv = document.getElementById("hint");
    const shareResults = document.getElementById("share-results");
    const streakEl = document.getElementById("streak");
    const userInfo = document.getElementById("user-info");
    const loginForm = document.getElementById("login-form");
    const usernameInput = document.getElementById("username-input");
    const loginButton = document.getElementById("login-button");
    const logoutButton = document.getElementById("logout-button");
    const themeToggle = document.getElementById("theme-toggle");

    let startTime;
    let timerInterval;
    let questionElements = [];
    let stars = 0;
    let correctCount = 0;
    let totalTime = 0;
    let isCorrect = false;
    let gameActive = false;
    const defaultUser = "Guest";
    const storedUser = localStorage.getItem("godle_current_user");
    let currentUser = storedUser ? storedUser : defaultUser;

    submitBtn.textContent = "Start Game";
    scheduleNextReleaseCheck(nextScheduledReleaseDate);

    function setMenuOpen(open) {
      document.body.classList.toggle("menu-open", open);
      menuToggle.setAttribute("aria-expanded", open ? "true" : "false");
      menuToggle.setAttribute("aria-label", open ? "Close game menu" : "Open game menu");
      menuToggle.textContent = open ? "‚úï Close" : "‚ò∞ Menu";
      sideMenu.setAttribute("aria-hidden", open ? "false" : "true");
    }
    function toggleMenu() {
      const isOpen = document.body.classList.contains("menu-open");
      setMenuOpen(!isOpen);
      if (isOpen) {
        menuToggle.focus();
      } else {
        sideMenu.focus();
      }
    }
    function closeMenu() {
      if (document.body.classList.contains("menu-open")) {
        setMenuOpen(false);
        menuToggle.focus();
      }
    }

    menuToggle.addEventListener("click", toggleMenu);
    menuBackdrop.addEventListener("click", closeMenu);
    document.addEventListener("keydown", (event) => {
      if (event.key === "Escape") {
        closeMenu();
      }
    });

    const themeStorageKey = "godle_theme";
    function applyThemePreference(mode) {
      const useLight = mode === "light";
      document.body.classList.toggle("light-mode", useLight);
      if (themeToggle) {
        themeToggle.checked = useLight;
      }
    }

    const storedThemePreference = localStorage.getItem(themeStorageKey);
    const colorSchemeQuery = window.matchMedia ? window.matchMedia('(prefers-color-scheme: light)') : null;
    const prefersLight = !!colorSchemeQuery && colorSchemeQuery.matches;
    const initialTheme = storedThemePreference === "light" || storedThemePreference === "dark"
      ? storedThemePreference
      : (prefersLight ? "light" : "dark");
    applyThemePreference(initialTheme);

    if (!storedThemePreference && colorSchemeQuery) {
      const handleSchemeChange = (event) => {
        applyThemePreference(event.matches ? "light" : "dark");
      };
      if (typeof colorSchemeQuery.addEventListener === "function") {
        colorSchemeQuery.addEventListener("change", handleSchemeChange);
      } else if (typeof colorSchemeQuery.addListener === "function") {
        colorSchemeQuery.addListener(handleSchemeChange);
      }
    }

    if (themeToggle) {
      themeToggle.addEventListener("change", () => {
        const nextTheme = themeToggle.checked ? "light" : "dark";
        applyThemePreference(nextTheme);
        localStorage.setItem(themeStorageKey, nextTheme);
      });
    }

    setMenuOpen(false);

    // ===== DAILY STREAK (LocalStorage only) =====
    function userStreakKey(name) {
      return `godle_user_${name}_streak`;
    }
    function todayKey(tz = "America/New_York") {
      return new Intl.DateTimeFormat('en-CA', { timeZone: tz, year: 'numeric', month: '2-digit', day: '2-digit'}).format(new Date());
    }
    function daysBetween(d1, d2) {
      const a = new Date(`${d1}T00:00:00Z`), b = new Date(`${d2}T00:00:00Z`);
      return Math.round((b - a) / 86400000);
    }
    function readLocalStreak() {
      if (!currentUser || currentUser === defaultUser) return { current: 0, best: 0, last: "" };
      try {
        const data = localStorage.getItem(userStreakKey(currentUser));
        return data ? JSON.parse(data) : { current: 0, best: 0, last: "" };
      } catch {
        return { current: 0, best: 0, last: "" };
      }
    }
    function writeLocalStreak(data) {
      if (!currentUser || currentUser === defaultUser) return;
      localStorage.setItem(userStreakKey(currentUser), JSON.stringify(data));
    }
    function renderStreak(s) {
      if (!currentUser || currentUser === defaultUser) {
        streakEl.textContent = "üî• Guest play (streak not saved)";
        return;
      }
      const current = s?.current || 0;
      const best = s?.best || 0;
      const t = current === 1 ? "day" : "days";
      streakEl.textContent = `üî• ${current}-${t} streak (best ${best})`;
    }
    function updateStreakOnWin() {
      if (!currentUser || currentUser === defaultUser) return;
      const today = todayKey();
      let s = readLocalStreak();
      if (!s.last) {
        s.current = 1; s.best = 1; s.last = today;
      } else if (s.last === today) {
        // already counted today ‚Äî do nothing
      } else {
        const gap = daysBetween(s.last, today);
        if (gap === 1) s.current += 1;
        else if (gap > 1) s.current = 1;
        s.best = Math.max(s.best, s.current);
        s.last = today;
      }
      writeLocalStreak(s);
      renderStreak(s);
    }
    function applyAuthState() {
      if (currentUser && currentUser !== defaultUser) {
        userInfo.textContent = `üë§ ${currentUser}`;
        loginButton.textContent = "Switch User";
        logoutButton.style.display = "block";
        usernameInput.value = currentUser;
      } else {
        userInfo.textContent = defaultUser;
        loginButton.textContent = "Log In";
        logoutButton.style.display = "none";
        usernameInput.value = "";
      }
      renderStreak(readLocalStreak());
    }
    applyAuthState();

    loginForm.addEventListener("submit", (event) => {
      event.preventDefault();
      const name = usernameInput.value.trim();
      if (!name) {
        alert("Enter a username to log in.");
        usernameInput.focus();
        return;
      }
      currentUser = name;
      localStorage.setItem("godle_current_user", currentUser);
      if (!localStorage.getItem(userStreakKey(currentUser))) {
        writeLocalStreak({ current: 0, best: 0, last: "" });
      }
      applyAuthState();
      submitBtn.focus();
    });

    logoutButton.addEventListener("click", () => {
      currentUser = defaultUser;
      localStorage.removeItem("godle_current_user");
      applyAuthState();
      usernameInput.focus();
    });

    // ===== INIT =====
    function initGame() {
      questionsDiv.innerHTML = '';
      guessContainer.innerHTML = '';
      gameOverDiv.innerHTML = '';
      gameOverDiv.style.display = 'none';
      starsDiv.innerHTML = '';
      shareResults.style.display = 'none';
      currentStep = 0;
      stars = 0;
      correctCount = 0;
      totalTime = 0;
      isCorrect = false;
      submitBtn.disabled = false;
      hintBtn.disabled = false;
      hintBtn.style.display = 'none';
      hintDiv.style.display = 'none';
      hintDiv.textContent = '';
      questionElements = [];
      timerDiv.textContent = '‚è± Time: 0:00';
    }

    function updateTimer() {
      const now = new Date();
      const elapsed = Math.floor((now - startTime) / 1000);
      const minutes = Math.floor(elapsed / 60);
      const seconds = elapsed % 60;
      timerDiv.textContent = `‚è± Time: ${minutes}:${seconds.toString().padStart(2, '0')}`;
    }
    
    function getElapsedSeconds() { 
      return Math.floor((new Date() - startTime) / 1000); 
    }

    function renderQuestion() {
      const questionContainer = document.createElement("div");
      questionContainer.className = "question-container";

      const questionText = document.createElement("div");
      questionText.className = "question-text";
      questionText.textContent = questions[currentStep];
      questionContainer.appendChild(questionText);

      const resultSpan = document.createElement("div");
      resultSpan.className = "question-result";
      resultSpan.id = `result-${currentStep}`;
      questionContainer.appendChild(resultSpan);

      questionsDiv.appendChild(questionContainer);
      questionElements.push(questionContainer);

      const rowDiv = document.createElement("div");
      rowDiv.className = "row";
      for (let i = 0; i < pyramid[currentStep]; i++) {
        const input = document.createElement("input");
        // Add special class for final code row
        if (currentStep === pyramid.length - 1) {
  rowDiv.classList.add("final-code");
          }
        input.className = "cell active";
        input.maxLength = 1;
        input.type = "text";
        input.inputMode = "numeric";
        input.setAttribute('inputmode','numeric');
        input.setAttribute('pattern','\\d');
        input.addEventListener("input", (e) => {
          e.target.value = e.target.value.replace(/\D/g, '').slice(0,1);
          if (e.target.value.length === 1 && i < pyramid[currentStep] - 1) {
            rowDiv.children[i + 1].focus();
          }
        });
        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter") submitBtn.click();
          if ((e.key === "Backspace" || e.key === "Delete") && e.target.value === "" && i > 0) {
            rowDiv.children[i - 1].focus();
            return;
          }
          if (e.key === "ArrowLeft") {
            e.preventDefault();
            if (i > 0) {
              rowDiv.children[i - 1].focus();
            }
            return;
          }
          if (e.key === "ArrowRight") {
            e.preventDefault();
            if (i < rowDiv.children.length - 1) {
              rowDiv.children[i + 1].focus();
            }
          }
        });
        rowDiv.appendChild(input);
      }
      
      guessContainer.appendChild(rowDiv);
      if (rowDiv.firstChild) rowDiv.firstChild.focus();

      // Show hint button only on final question
      hintBtn.style.display = currentStep === pyramid.length - 1 ? "block" : "none";
      hintDiv.style.display = "none";
    }

    function getInputValues() {
      const activeInputs = document.querySelectorAll(".cell.active");
      return Array.from(activeInputs).map(input => input.value.trim());
    }

    // Wordle-style duplicate handling
    function colorFeedback(guess, codeArr) {
      const res = Array(guess.length).fill('gray');
      const counts = {};
      codeArr.forEach((d) => { counts[d] = (counts[d] || 0) + 1; });
      // pass 1: greens
      guess.forEach((d,i) => {
        if (codeArr[i] === d) { res[i] = 'green'; counts[d]--; }
      });
      // pass 2: yellows
      guess.forEach((d,i) => {
        if (res[i] === 'gray' && counts[d] > 0) { res[i] = 'yellow'; counts[d]--; }
      });
      return res;
    }

    function evaluate(inputArr) {
      const inputDigits = inputArr.map(val => isNaN(val) ? val : Number(val));
      isCorrect = inputDigits.every((val, i) =>
        val === correctAnswers[currentStep][i] ||
        (typeof val === 'string' && val.toUpperCase() === String(correctAnswers[currentStep][i]).toUpperCase())
      );

      const resultSpan = document.getElementById(`result-${currentStep}`);
      resultSpan.textContent = isCorrect ? "‚úÖ" : "‚ùå";
      if (isCorrect && currentStep < 4) { correctCount++; }

      const feedback = colorFeedback(inputDigits, code);
      const activeInputs = document.querySelectorAll(".cell.active");
      activeInputs.forEach((input, i) => { 
        input.classList.remove("active"); 
        input.classList.add(feedback[i]); 
        input.disabled = true; 
      });
    }

    function showShareButtons() { shareResults.style.display = "block"; }

    function shareTwitter() {
      window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(buildShareText())}`, '_blank', 'noopener');
    }
    function shareFacebook() {
      const shareText = buildShareText();
      const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${encodeURIComponent(shareText)}`;
      const win = window.open(shareUrl, '_blank', 'noopener,width=626,height=436');
      if (!win) {
        copyResults();
        alert('Facebook share popup was blocked. Your results were copied‚Äîpaste them into Facebook manually.');
      }
    }

    function shareReddit() {
      const titleSuffix = activePuzzleReleaseDate ? ` - ${activePuzzleReleaseDate}` : '';
      const shareUrl = `https://www.reddit.com/r/godle/submit?selftext=true&title=${encodeURIComponent(`G√∂dle Results${titleSuffix}`)}&text=${encodeURIComponent(buildShareText())}`;
      const win = window.open(shareUrl, '_blank', 'noopener,width=960,height=700');
      if (!win) { copyResults(); alert('Reddit share popup was blocked. Your results were copied‚Äîshare them in r/godle manually.'); }
    }

    function shareBluesky() {
      const shareUrl = `https://bsky.app/intent/compose?text=${encodeURIComponent(buildShareText())}`;
      const win = window.open(shareUrl, '_blank', 'noopener');
      if (!win) { copyResults(); alert('Bluesky share popup was blocked. Your results were copied‚Äîpost them on Bluesky manually.'); }
    }

    function buildShareText() {
      const minutes = Math.floor(totalTime / 60);
      const seconds = totalTime % 60;
      let grid = "";
      const inputs = document.querySelectorAll(".cell");
      let index = 0;
      for (let r = 0; r < pyramid.length - 1; r++) {
        let row = "";
        for (let c = 0; c < pyramid[r]; c++) {
          const cell = inputs[index++];
          if (cell && cell.classList.contains("green")) row += "üü©";
          else if (cell && cell.classList.contains("yellow")) row += "üü®";
          else row += "‚¨õ";
        }
        grid += (r > 0 ? "\n" : "") + row;
      }
      return `G√∂dle - I solved it in ${minutes}:${seconds.toString().padStart(2,'0')} with ${stars} stars! ‚≠ê\n${grid}\n\nTry it yourself: ${window.location.href}`;
    }

    async function copyResults() {
      const text = buildShareText();
      try {
        await navigator.clipboard.writeText(text);
        document.getElementById("copy-message").style.display = "block";
        setTimeout(() => { document.getElementById("copy-message").style.display = "none"; }, 2000);
      } catch (err) {
        const ta = document.createElement('textarea');
        ta.value = text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
        document.getElementById("copy-message").style.display = "block";
        setTimeout(() => { document.getElementById("copy-message").style.display = "none"; }, 2000);
      }
    }

    // === Hint button ===
    hintBtn.addEventListener("click", () => {
      hintDiv.textContent = hintText;
      hintDiv.style.display = "block";
      hintBtn.disabled = true;
      hintDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    });

    // === Submit flow ===
    submitBtn.addEventListener("click", () => {
      if (!gameActive) {
        startGame();
        return;
      }
      const values = getInputValues();
      const expectedLen = pyramid[currentStep];
      if (values.length !== expectedLen || values.some(v => v === "")) {
        alert("Please complete this guess.");
        return;
      }

      evaluate(values);
      currentStep++;

      if (currentStep < pyramid.length) {
        renderQuestion();
      } else {
        clearInterval(timerInterval);
        const guess = values.map(val => isNaN(val) ? val : Number(val));
        isCorrect = guess.every((d, i) => d === code[i]);
        totalTime = getElapsedSeconds();
        const minutes = Math.floor(totalTime / 60);
        const seconds = totalTime % 60;
        gameOverDiv.style.display = 'block';
        gameOverDiv.innerHTML = isCorrect
          ? `üéâ You cracked the code in ${minutes}:${seconds.toString().padStart(2, '0')}`
          : `‚ùå Incorrect. The code was ${code.join("")}`;

        submitBtn.disabled = true;

        if (isCorrect) {
          if (totalTime <= 60) stars++;
          stars += correctCount;
          starsDiv.textContent = `‚≠ê Stars: ${stars}`;
          updateStreakOnWin();
          showShareButtons();
        } else {
          stars = 0;
        }

        gameActive = false;
        submitBtn.textContent = "Start Game";
        submitBtn.disabled = false;
      }
    });

    function startGame() {
      if (timerInterval) {
        clearInterval(timerInterval);
      }
      initGame();
      setMenuOpen(false);
      startTime = new Date();
      timerInterval = setInterval(updateTimer, 1000);
      gameActive = true;
      submitBtn.textContent = "Submit Guess";
      renderQuestion();
    }

    // Optional: keep focused cell visible on mobile when keyboard opens
    document.addEventListener('focusin', (e) => {
      if (e.target.classList?.contains('cell')) {
        e.target.scrollIntoView({ block: 'center', behavior: 'smooth' });
      }
    });
  </script>
</body>
</html>
