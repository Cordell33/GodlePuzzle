<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GÃ¶dle</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #121212;
      color: #eee;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      margin: 0;
      min-height: 100vh;
      transition: background 0.3s ease, color 0.3s ease;
      color-scheme: dark;
    }
    body.light-mode {
      background: #f6f7f9;
      color: #1b1b1b;
      color-scheme: light;
    }
    h1 { 
      font-size: 2.8rem; 
      margin-bottom: 1rem; 
      color: #00bcd4;
      text-shadow: 0 0 10px rgba(0, 188, 212, 0.5);
    }
    .game-area {
      display: flex;
      align-items: flex-start;
      gap: 2rem;
      flex-wrap: wrap;
      justify-content: center;
      margin: 1rem 0;
    }
    .rules-card {
      width: 100%;
      max-width: 700px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 1.5rem 2rem;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.35);
      margin: 0 0 1.5rem;
      transition: background 0.3s ease, box-shadow 0.3s ease;
    }
    .rules-card h2 {
      margin-top: 0;
      margin-bottom: 0.75rem;
      font-size: 1.6rem;
      color: #00bcd4;
      text-shadow: 0 0 8px rgba(0, 188, 212, 0.4);
    }
    .rules-card p {
      margin-top: 0;
      margin-bottom: 0.75rem;
      color: #ddd;
      line-height: 1.5;
      transition: color 0.3s ease;
    }
    .rules-card ul {
      margin: 0;
      padding-left: 1.3rem;
      color: #ccc;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      font-size: 1.05rem;
      transition: color 0.3s ease;
    }
    .rules-card ul b {
      color: #fff;
    }
    .questions { 
      font-size: 1.2rem; 
      min-width: 280px; 
      display: flex; 
      flex-direction: column; 
      gap: 1rem; 
    }
    .question-container { 
      display: flex; 
      align-items: center; 
      gap: 0.5rem; 
    }
    .question-text {
      background-color: #333;
      border-left: 4px solid #00bcd4;
      padding: 0.8rem;
      font-weight: bold;
      border-radius: 4px;
      flex-grow: 1;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      transition: background-color 0.3s ease, box-shadow 0.3s ease, color 0.3s ease;
    }
    .question-result { 
      font-size: 1.8rem; 
      min-width: 40px;
      text-align: center;
    }
    .hint-text {
      background-color: #333;
      border-left: 4px solid #ff9800;
      padding: 0.8rem;
      font-style: italic;
      border-radius: 4px;
      margin-top: 1rem;
      display: none;
      animation: fadeIn 0.5s ease-in;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .guesses { 
      display: flex; 
      flex-direction: column; 
      align-items: flex-start; 
      width: 100%; 
      max-width: 20rem; 
    }
    .row { 
      display: flex; 
      margin: 0.5rem 0; 
      justify-content: flex-start; 
      align-items: center; 
    }
    .cell { 
      width: 3rem; 
      height: 3rem; 
      font-size: 1.5rem; 
      margin: 0.2rem; 
      text-align: center; 
      border: 2px solid #444; 
      border-radius: 8px; 
      background: #222; 
      color: white;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    .cell:focus {
      outline: none;
      border-color: #00bcd4;
      box-shadow: 0 0 10px rgba(0, 188, 212, 0.5);
    }
    .cell.green { 
      background: #2ecc71; 
      border-color: #27ae60;
      transform: scale(1.05);
    }
    .cell.yellow { 
      background: #f39c12; 
      border-color: #d35400;
      transform: scale(1.05);
    }
    .cell.gray { 
      background: #7f8c8d; 
      border-color: #636e72;
    }
    /* Final code row gets a red border */
    .row.final-code .cell {
      border: 2px solid #27ae60;
      box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
    }

    #submit, #hint-button { 
      margin-top: 1.5rem; 
      padding: 0.8rem 1.5rem; 
      font-size: 1.1rem; 
      width: 100%; 
      max-width: 300px; 
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    #submit {
      background: #00bcd4;
      color: white;
    }
    #submit:hover {
      background: #0097a7;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    #hint-button {
      background: #ff9800;
      color: white;
    }
    #hint-button:hover {
      background: #f57c00;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    #game-over {
      margin-top: 1.5rem;
      font-size: 1.5rem;
      text-align: center;
      padding: 1rem;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.1);
      animation: fadeIn 0.5s ease-in;
      display: none; /* hidden until end */
      transition: background 0.3s ease, color 0.3s ease;
    }
    #menu-toggle {
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 1100;
      background: #00bcd4;
      color: #121212;
      border: none;
      border-radius: 999px;
      padding: 0.55rem 1.1rem;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      transition: background 0.2s ease, transform 0.2s ease;
    }
    #menu-toggle:hover {
      background: #00a0b7;
      transform: translateY(-1px);
    }
    body.menu-open #menu-toggle {
      background: #0097a7;
      color: #fff;
    }
    #menu-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 1000;
    }
    body.menu-open #menu-backdrop {
      opacity: 1;
      pointer-events: auto;
    }
    #side-menu {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: min(320px, 85vw);
      background: #1b1b1b;
      box-shadow: 8px 0 24px rgba(0, 0, 0, 0.45);
      transform: translateX(-100%);
      transition: transform 0.3s ease, background 0.3s ease, box-shadow 0.3s ease, color 0.3s ease;
      z-index: 1050;
      padding: 1.5rem 1.75rem 2rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      overflow-y: auto;
    }
    body.menu-open #side-menu {
      transform: translateX(0);
    }
    #side-menu h2 {
      margin: 0;
      color: #00bcd4;
      font-size: 1.5rem;
      text-shadow: 0 0 8px rgba(0, 188, 212, 0.4);
    }
    #side-menu p {
      margin: 0;
      color: #ddd;
      line-height: 1.4;
      transition: color 0.3s ease;
    }
    .login-panel {
      margin-top: 1.5rem;
      background: rgba(255, 255, 255, 0.05);
      padding: 1rem 1.5rem;
      border-radius: 12px;
      max-width: 420px;
      width: 100%;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.25);
      transition: background 0.3s ease, box-shadow 0.3s ease;
    }
    .login-panel label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    .login-row {
      display: flex;
      gap: 0.5rem;
    }
    .login-panel input[type="text"] {
      flex: 1;
      padding: 0.6rem 0.8rem;
      border-radius: 8px;
      border: 1px solid #444;
      background: #1e1e1e;
      color: #fff;
      font-size: 1rem;
      transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }
    .login-panel input[type="text"]:focus {
      outline: none;
      border-color: #00bcd4;
      box-shadow: 0 0 0 3px rgba(0, 188, 212, 0.2);
    }
    .login-panel button {
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      border: none;
      background: #00bcd4;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .login-panel button:hover {
      background: #0097a7;
    }
    .login-panel .external-link {
      margin-top: 0.75rem;
      display: block;
      color: #00bcd4;
      font-weight: 600;
      text-decoration: none;
      transition: color 0.2s ease;
    }
    .login-panel .external-link:hover {
      color: #ff9800;
      text-decoration: underline;
    }
    #logout-button {
      margin-top: 0.75rem;
      width: 100%;
      background: #ef5350;
    }
    #logout-button:hover {
      background: #e53935;
    }
    .login-hint {
      margin-top: 0.75rem;
      font-size: 0.9rem;
      color: #ccc;
      transition: color 0.3s ease;
    }
    #timer {
      margin-top: 1rem;
      font-size: 1.3rem;
      color: #00bcd4;
      font-weight: bold;
    }
    #stars { 
      margin-top: 1rem; 
      font-size: 1.8rem; 
      color: gold;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }
    .share-buttons { 
      display: flex; 
      gap: 1rem; 
      margin-top: 1.5rem; 
      justify-content: center; 
      flex-wrap: wrap; 
    }
    .share-button { 
      padding: 0.8rem 1.5rem; 
      border-radius: 8px; 
      border: none; 
      cursor: pointer; 
      font-size: 1rem; 
      display: flex; 
      align-items: center; 
      gap: 0.5rem; 
      font-weight: bold;
      transition: all 0.3s ease;
    }
    .share-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    .share-button.twitter { background: #1DA1F2; color: white; }
    .share-button.facebook { background: #4267B2; color: white; }
    .share-button.copy { background: #333; color: white; }
    #copy-message { 
      margin-top: 1rem; 
      color: #00bcd4; 
      display: none;
      animation: fadeIn 0.5s ease-in;
    }
    #share-results { 
      margin-top: 2rem; 
      display: none; 
      text-align: center;
      animation: fadeIn 0.5s ease-in;
    }
    footer {
      margin-top: 3rem;
      font-size: 0.9rem;
      color: #777;
      text-align: center;
      padding: 1.5rem;
      border-top: 1px solid #333;
      width: 100%;
      max-width: 600px;
      transition: color 0.3s ease, border-color 0.3s ease;
    }
    footer a {
      color: #00bcd4;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    footer a:hover {
      color: #ff9800;
      text-decoration: underline;
    }

    .theme-toggle {
      margin-top: auto;
      padding-top: 1.25rem;
      border-top: 1px solid rgba(255, 255, 255, 0.12);
    }
    .toggle-control {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      font-weight: 600;
      color: #ddd;
      cursor: pointer;
      user-select: none;
      position: relative;
    }
    .toggle-control input {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }
    .toggle-control .switch {
      width: 48px;
      height: 26px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.3);
      position: relative;
      transition: background 0.3s ease;
      flex-shrink: 0;
    }
    .toggle-control .switch::after {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
      transition: transform 0.3s ease;
    }
    .toggle-control input:checked + .switch {
      background: #00bcd4;
    }
    .toggle-control input:checked + .switch::after {
      transform: translateX(22px);
    }
    .toggle-control input:focus-visible + .switch {
      box-shadow: 0 0 0 3px rgba(0, 188, 212, 0.45);
    }

    body.light-mode .rules-card {
      background: rgba(0, 0, 0, 0.05);
      box-shadow: 0 10px 24px rgba(31, 64, 79, 0.15);
    }
    body.light-mode .rules-card p {
      color: #2d2d2d;
    }
    body.light-mode .rules-card ul {
      color: #3b3b3b;
    }
    body.light-mode .rules-card ul b {
      color: #000;
    }
    body.light-mode .question-text {
      background-color: #eef3f7;
      color: #1b1b1b;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12);
    }
    body.light-mode .hint-text {
      background-color: #fff3e0;
      color: #5c3b00;
    }
    body.light-mode .cell {
      background: #ffffff;
      color: #111;
      border-color: #c3c8d0;
    }
    body.light-mode .cell.green {
      background: #66bb6a;
      border-color: #43a047;
      color: #0b2f16;
    }
    body.light-mode .cell.yellow {
      background: #ffd54f;
      border-color: #ffb300;
      color: #5a4100;
    }
    body.light-mode .cell.gray {
      background: #cfd8dc;
      border-color: #b0bec5;
    }
    body.light-mode .cell:focus {
      border-color: #00a0b7;
      box-shadow: 0 0 10px rgba(0, 160, 183, 0.4);
    }
    body.light-mode #side-menu {
      background: #fdfdfd;
      box-shadow: 8px 0 24px rgba(0, 0, 0, 0.1);
      color: #1f1f1f;
    }
    body.light-mode #side-menu p {
      color: #444;
    }
    body.light-mode .login-panel {
      background: rgba(0, 0, 0, 0.05);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.12);
    }
    body.light-mode .login-panel input[type="text"] {
      background: #fff;
      color: #111;
      border-color: #b8bec6;
    }
    body.light-mode .login-panel input[type="text"]::placeholder {
      color: #757575;
    }
    body.light-mode .login-panel input[type="text"]:focus {
      box-shadow: 0 0 0 3px rgba(0, 160, 183, 0.25);
    }
    body.light-mode .login-hint {
      color: #555;
    }
    body.light-mode #game-over {
      background: rgba(0, 0, 0, 0.06);
      color: #1b1b1b;
    }
    body.light-mode footer {
      color: #555;
      border-top: 1px solid #d4d4d4;
    }
    body.light-mode .share-button.copy {
      background: #f0f2f5;
      color: #1e1e1e;
    }
    body.light-mode .share-button.copy:hover {
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.18);
    }
    body.light-mode .theme-toggle {
      border-top: 1px solid rgba(0, 0, 0, 0.12);
    }
    body.light-mode .toggle-control {
      color: #2c2c2c;
    }
    body.light-mode .toggle-control .switch {
      background: rgba(0, 0, 0, 0.2);
    }
    body.light-mode .toggle-control input:checked + .switch {
      background: #0097a7;
    }
    body.light-mode .toggle-control .switch::after {
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }
    @media (max-width: 600px) {
      body { padding: 1rem; }
      .cell { width: 2.8rem; height: 2.8rem; font-size: 1.3rem; }
      .game-area { flex-direction: column; align-items: center; }
      .questions { min-width: 100%; }
      h1 { font-size: 2.2rem; }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background-color: #f39c12;
      opacity: 0.7;
      animation: confetti-fall 5s linear forwards;
      z-index: 1000;
    }
    
    @keyframes confetti-fall {
      0% {
        transform: translateY(-100px) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <button id="menu-toggle" type="button" aria-expanded="false" aria-controls="side-menu" aria-label="Open game menu">â° Menu</button>
  <div id="menu-backdrop" role="presentation"></div>
  <aside id="side-menu" aria-hidden="true" tabindex="-1">
    <h2>Game Menu</h2>
    <p>Sign in to track your streak, then use the Start Game button below the board whenever you're ready to play.</p>
    <div class="login-panel" aria-live="polite">
      <form id="login-form">
        <label for="username-input">Player username</label>
        <div class="login-row">
          <input id="username-input" name="username" type="text" placeholder="Enter username" autocomplete="nickname" required />
          <button type="submit" id="login-button">Log In</button>
        </div>
      </form>
      <button id="logout-button" type="button" style="display: none;">Log Out</button>
      <p class="login-hint">Your daily streak is saved per username on this device.</p>
      <a class="external-link" href="https://cordell33.github.io/GodleHex/" target="_blank" rel="noopener noreferrer">GodleHex (weekly)</a>
      <a class="external-link" href="https://cordell33.github.io/Cordlle/" target="_blank" rel="noopener noreferrer">Cordlle (monthly)</a>
    </div>
    <div class="theme-toggle">
      <label class="toggle-control" for="theme-toggle">
        <span>Light background</span>
        <input type="checkbox" id="theme-toggle" />
        <span class="switch" aria-hidden="true"></span>
      </label>
    </div>
  </aside>

  <div id="auth-bar" style="width:100%;max-width:680px;display:flex;justify-content:space-between;align-items:center;margin:0.5rem 0 0.25rem;">
    <div id="user-info">Guest</div>
    <div id="streak" title="Daily streak">ð¥ Guest play (streak not saved)</div>
  </div>

  <h1>GÃ¶dle</h1>

  <section class="rules-card" aria-labelledby="rules-heading">
    <h2 id="rules-heading">How to Play</h2>
    <p>Crack the daily code by solving quick logic and math prompts, then combine your answers to guess the final digits.</p>
    <ul>
      <li>Answer 4 questions using every digit (0-9) <b>exactly once</b>.</li>
      <li>Use your solutions as clues for the final 5-digit code.</li>
      <li><b>Green</b> = correct digit & position, <b>Yellow</b> = correct digit, wrong position.</li>
      <li>Beat the clock to earn bonus stars and share your results.</li>
      <li>Click <b>Start Game</b> below to begin, then <b>Submit Guess</b> for each row.</li>
    </ul>
  </section>

  <div id="timer">â± Time: 0:00</div>
  <div class="game-area">
    <div class="questions" id="questions"></div>
    <div class="guesses" id="guess-container"></div>
  </div>
  <button id="submit">Submit Guess</button>
  <button id="hint-button" style="display: none;">Hint</button>
  <div id="hint" class="hint-text"></div>
  <div id="stars"></div>
  <div id="game-over" aria-live="polite"></div>

  <div id="share-results">
    <h3>Share Your Results</h3>
    <div class="share-buttons">
      <button class="share-button twitter" onclick="shareTwitter()" aria-label="Share results to Twitter">X/Twitter</button>
      <button class="share-button facebook" onclick="shareFacebook()" aria-label="Share results to Facebook">Facebook</button>
      <button class="share-button copy" onclick="copyResults()" aria-label="Copy results to clipboard">Copy Link</button>
    </div>
    <div id="copy-message" aria-live="polite">Copied to clipboard!</div>
  </div>

  <footer>created by Cordell Booth â¢ <a href="https://patreon.com/GodleCreator" target="_blank">Donate</a> â¢ <a href="https://www.facebook.com/groups/2109717096181882" target="_blank">Community</a></footer>

  <script>
    // ====== PUZZLE CONTENT ======

   const questions = [
"100 - 69 - 14 - 7 - 4 - 3 - 2 -1 = ?",
  "Jason Voorhees is best known for Friday of this date? __thâ, 
  "4 Ã 181 = ? ",
  "20,955 Ã· 3 = ?",
  "Enter the final 5-digit code"
];

const correctAnswers = [
  [0],
  [1, 3],
  [7, 2, 4],
  [6, 9, 8, 5],
  [3, 2, 8, 5, 7]
];

const hintText = "0, 13, 724, 6985.";
const pyramid = [1, 2, 3, 4, 5];
let code = [3, 2, 8, 5, 7];


    // ====== GAME STATE & DOM ======
    let currentStep = 0;
    const questionsDiv = document.getElementById("questions");
    const guessContainer = document.getElementById("guess-container");
    const submitBtn = document.getElementById("submit"); // FIX: define before use
    const hintBtn = document.getElementById("hint-button");
    const gameOverDiv = document.getElementById("game-over");
    const starsDiv = document.getElementById("stars");
    const menuToggle = document.getElementById("menu-toggle");
    const menuBackdrop = document.getElementById("menu-backdrop");
    const sideMenu = document.getElementById("side-menu");
    const timerDiv = document.getElementById("timer");
    const hintDiv = document.getElementById("hint");
    const shareResults = document.getElementById("share-results");
    const streakEl = document.getElementById("streak");
    const userInfo = document.getElementById("user-info");
    const loginForm = document.getElementById("login-form");
    const usernameInput = document.getElementById("username-input");
    const loginButton = document.getElementById("login-button");
    const logoutButton = document.getElementById("logout-button");
    const themeToggle = document.getElementById("theme-toggle");

    let startTime;
    let timerInterval;
    let questionElements = [];
    let stars = 0;
    let correctCount = 0;
    let totalTime = 0;
    let isCorrect = false;
    let gameActive = false;
    const defaultUser = "Guest";
    const storedUser = localStorage.getItem("godle_current_user");
    let currentUser = storedUser ? storedUser : defaultUser;

    submitBtn.textContent = "Start Game";

    function setMenuOpen(open) {
      document.body.classList.toggle("menu-open", open);
      menuToggle.setAttribute("aria-expanded", open ? "true" : "false");
      menuToggle.setAttribute("aria-label", open ? "Close game menu" : "Open game menu");
      menuToggle.textContent = open ? "â Close" : "â° Menu";
      sideMenu.setAttribute("aria-hidden", open ? "false" : "true");
    }
    function toggleMenu() {
      const isOpen = document.body.classList.contains("menu-open");
      setMenuOpen(!isOpen);
      if (isOpen) {
        menuToggle.focus();
      } else {
        sideMenu.focus();
      }
    }
    function closeMenu() {
      if (document.body.classList.contains("menu-open")) {
        setMenuOpen(false);
        menuToggle.focus();
      }
    }

    menuToggle.addEventListener("click", toggleMenu);
    menuBackdrop.addEventListener("click", closeMenu);
    document.addEventListener("keydown", (event) => {
      if (event.key === "Escape") {
        closeMenu();
      }
    });

    const themeStorageKey = "godle_theme";
    function applyThemePreference(mode) {
      const useLight = mode === "light";
      document.body.classList.toggle("light-mode", useLight);
      if (themeToggle) {
        themeToggle.checked = useLight;
      }
    }

    const storedThemePreference = localStorage.getItem(themeStorageKey);
    const colorSchemeQuery = window.matchMedia ? window.matchMedia('(prefers-color-scheme: light)') : null;
    const prefersLight = !!colorSchemeQuery && colorSchemeQuery.matches;
    const initialTheme = storedThemePreference === "light" || storedThemePreference === "dark"
      ? storedThemePreference
      : (prefersLight ? "light" : "dark");
    applyThemePreference(initialTheme);

    if (!storedThemePreference && colorSchemeQuery) {
      const handleSchemeChange = (event) => {
        applyThemePreference(event.matches ? "light" : "dark");
      };
      if (typeof colorSchemeQuery.addEventListener === "function") {
        colorSchemeQuery.addEventListener("change", handleSchemeChange);
      } else if (typeof colorSchemeQuery.addListener === "function") {
        colorSchemeQuery.addListener(handleSchemeChange);
      }
    }

    if (themeToggle) {
      themeToggle.addEventListener("change", () => {
        const nextTheme = themeToggle.checked ? "light" : "dark";
        applyThemePreference(nextTheme);
        localStorage.setItem(themeStorageKey, nextTheme);
      });
    }

    setMenuOpen(false);

    // ===== DAILY STREAK (LocalStorage only) =====
    function userStreakKey(name) {
      return `godle_user_${name}_streak`;
    }
    function todayKey(tz = "America/New_York") {
      return new Intl.DateTimeFormat('en-CA', { timeZone: tz, year: 'numeric', month: '2-digit', day: '2-digit'}).format(new Date());
    }
    function daysBetween(d1, d2) {
      const a = new Date(`${d1}T00:00:00Z`), b = new Date(`${d2}T00:00:00Z`);
      return Math.round((b - a) / 86400000);
    }
    function readLocalStreak() {
      if (!currentUser || currentUser === defaultUser) return { current: 0, best: 0, last: "" };
      try {
        const data = localStorage.getItem(userStreakKey(currentUser));
        return data ? JSON.parse(data) : { current: 0, best: 0, last: "" };
      } catch {
        return { current: 0, best: 0, last: "" };
      }
    }
    function writeLocalStreak(data) {
      if (!currentUser || currentUser === defaultUser) return;
      localStorage.setItem(userStreakKey(currentUser), JSON.stringify(data));
    }
    function renderStreak(s) {
      if (!currentUser || currentUser === defaultUser) {
        streakEl.textContent = "ð¥ Guest play (streak not saved)";
        return;
      }
      const current = s?.current || 0;
      const best = s?.best || 0;
      const t = current === 1 ? "day" : "days";
      streakEl.textContent = `ð¥ ${current}-${t} streak (best ${best})`;
    }
    function updateStreakOnWin() {
      if (!currentUser || currentUser === defaultUser) return;
      const today = todayKey();
      let s = readLocalStreak();
      if (!s.last) {
        s.current = 1; s.best = 1; s.last = today;
      } else if (s.last === today) {
        // already counted today â do nothing
      } else {
        const gap = daysBetween(s.last, today);
        if (gap === 1) s.current += 1;
        else if (gap > 1) s.current = 1;
        s.best = Math.max(s.best, s.current);
        s.last = today;
      }
      writeLocalStreak(s);
      renderStreak(s);
    }
    function applyAuthState() {
      if (currentUser && currentUser !== defaultUser) {
        userInfo.textContent = `ð¤ ${currentUser}`;
        loginButton.textContent = "Switch User";
        logoutButton.style.display = "block";
        usernameInput.value = currentUser;
      } else {
        userInfo.textContent = defaultUser;
        loginButton.textContent = "Log In";
        logoutButton.style.display = "none";
        usernameInput.value = "";
      }
      renderStreak(readLocalStreak());
    }
    applyAuthState();

    loginForm.addEventListener("submit", (event) => {
      event.preventDefault();
      const name = usernameInput.value.trim();
      if (!name) {
        alert("Enter a username to log in.");
        usernameInput.focus();
        return;
      }
      currentUser = name;
      localStorage.setItem("godle_current_user", currentUser);
      if (!localStorage.getItem(userStreakKey(currentUser))) {
        writeLocalStreak({ current: 0, best: 0, last: "" });
      }
      applyAuthState();
      submitBtn.focus();
    });

    logoutButton.addEventListener("click", () => {
      currentUser = defaultUser;
      localStorage.removeItem("godle_current_user");
      applyAuthState();
      usernameInput.focus();
    });

    // ===== INIT =====
    function initGame() {
      questionsDiv.innerHTML = '';
      guessContainer.innerHTML = '';
      gameOverDiv.innerHTML = '';
      gameOverDiv.style.display = 'none';
      starsDiv.innerHTML = '';
      shareResults.style.display = 'none';
      currentStep = 0;
      stars = 0;
      correctCount = 0;
      totalTime = 0;
      isCorrect = false;
      submitBtn.disabled = false;
      hintBtn.disabled = false;
      hintBtn.style.display = 'none';
      hintDiv.style.display = 'none';
      hintDiv.textContent = '';
      questionElements = [];
      timerDiv.textContent = 'â± Time: 0:00';
    }

    function updateTimer() {
      const now = new Date();
      const elapsed = Math.floor((now - startTime) / 1000);
      const minutes = Math.floor(elapsed / 60);
      const seconds = elapsed % 60;
      timerDiv.textContent = `â± Time: ${minutes}:${seconds.toString().padStart(2, '0')}`;
    }
    
    function getElapsedSeconds() { 
      return Math.floor((new Date() - startTime) / 1000); 
    }

    function renderQuestion() {
      const questionContainer = document.createElement("div");
      questionContainer.className = "question-container";

      const questionText = document.createElement("div");
      questionText.className = "question-text";
      questionText.textContent = questions[currentStep];
      questionContainer.appendChild(questionText);

      const resultSpan = document.createElement("div");
      resultSpan.className = "question-result";
      resultSpan.id = `result-${currentStep}`;
      questionContainer.appendChild(resultSpan);

      questionsDiv.appendChild(questionContainer);
      questionElements.push(questionContainer);

      const rowDiv = document.createElement("div");
      rowDiv.className = "row";
      for (let i = 0; i < pyramid[currentStep]; i++) {
        const input = document.createElement("input");
        // Add special class for final code row
        if (currentStep === pyramid.length - 1) {
  rowDiv.classList.add("final-code");
          }
        input.className = "cell active";
        input.maxLength = 1;
        input.type = "text";
        input.inputMode = "numeric";
        input.setAttribute('inputmode','numeric');
        input.setAttribute('pattern','\\d');
        input.addEventListener("input", (e) => {
          e.target.value = e.target.value.replace(/\D/g, '').slice(0,1);
          if (e.target.value.length === 1 && i < pyramid[currentStep] - 1) {
            rowDiv.children[i + 1].focus();
          }
        });
        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter") submitBtn.click();
          if ((e.key === "Backspace" || e.key === "Delete") && e.target.value === "" && i > 0) {
            rowDiv.children[i - 1].focus();
            return;
          }
          if (e.key === "ArrowLeft") {
            e.preventDefault();
            if (i > 0) {
              rowDiv.children[i - 1].focus();
            }
            return;
          }
          if (e.key === "ArrowRight") {
            e.preventDefault();
            if (i < rowDiv.children.length - 1) {
              rowDiv.children[i + 1].focus();
            }
          }
        });
        rowDiv.appendChild(input);
      }
      
      guessContainer.appendChild(rowDiv);
      if (rowDiv.firstChild) rowDiv.firstChild.focus();

      // Show hint button only on final question
      hintBtn.style.display = currentStep === pyramid.length - 1 ? "block" : "none";
      hintDiv.style.display = "none";
    }

    function getInputValues() {
      const activeInputs = document.querySelectorAll(".cell.active");
      return Array.from(activeInputs).map(input => input.value.trim());
    }

    // Wordle-style duplicate handling
    function colorFeedback(guess, codeArr) {
      const res = Array(guess.length).fill('gray');
      const counts = {};
      codeArr.forEach((d) => { counts[d] = (counts[d] || 0) + 1; });
      // pass 1: greens
      guess.forEach((d,i) => {
        if (codeArr[i] === d) { res[i] = 'green'; counts[d]--; }
      });
      // pass 2: yellows
      guess.forEach((d,i) => {
        if (res[i] === 'gray' && counts[d] > 0) { res[i] = 'yellow'; counts[d]--; }
      });
      return res;
    }

    function evaluate(inputArr) {
      const inputDigits = inputArr.map(val => isNaN(val) ? val : Number(val));
      isCorrect = inputDigits.every((val, i) =>
        val === correctAnswers[currentStep][i] ||
        (typeof val === 'string' && val.toUpperCase() === String(correctAnswers[currentStep][i]).toUpperCase())
      );

      const resultSpan = document.getElementById(`result-${currentStep}`);
      resultSpan.textContent = isCorrect ? "â" : "â";
      if (isCorrect && currentStep < 4) { correctCount++; }

      const feedback = colorFeedback(inputDigits, code);
      const activeInputs = document.querySelectorAll(".cell.active");
      activeInputs.forEach((input, i) => { 
        input.classList.remove("active"); 
        input.classList.add(feedback[i]); 
        input.disabled = true; 
      });
    }

    function showShareButtons() { shareResults.style.display = "block"; }

    function shareTwitter() {
      window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(buildShareText())}`, '_blank', 'noopener');
    }
    function shareFacebook() {
      const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}`;
      const win = window.open(shareUrl, 'fb-share-dialog', 'width=626,height=436');
      if (!win) { copyResults(); alert('Facebook share popup was blocked. Your results were copiedâpaste into Facebook manually.'); }
    }

    function buildShareText() {
      const minutes = Math.floor(totalTime / 60);
      const seconds = totalTime % 60;
      let grid = "";
      const inputs = document.querySelectorAll(".cell");
      let index = 0;
      for (let r = 0; r < pyramid.length - 1; r++) {
        let row = "";
        for (let c = 0; c < pyramid[r]; c++) {
          const cell = inputs[index++];
          if (cell && cell.classList.contains("green")) row += "ð©";
          else if (cell && cell.classList.contains("yellow")) row += "ð¨";
          else row += "â¬";
        }
        grid += (r > 0 ? "\n" : "") + row;
      }
      return `GÃ¶dle - I solved it in ${minutes}:${seconds.toString().padStart(2,'0')} with ${stars} stars! â­\n${grid}\n\nTry it yourself: ${window.location.href}`;
    }

    async function copyResults() {
      const text = buildShareText();
      try {
        await navigator.clipboard.writeText(text);
        document.getElementById("copy-message").style.display = "block";
        setTimeout(() => { document.getElementById("copy-message").style.display = "none"; }, 2000);
      } catch (err) {
        const ta = document.createElement('textarea');
        ta.value = text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
        document.getElementById("copy-message").style.display = "block";
        setTimeout(() => { document.getElementById("copy-message").style.display = "none"; }, 2000);
      }
    }

    // === Hint button ===
    hintBtn.addEventListener("click", () => {
      hintDiv.textContent = hintText;
      hintDiv.style.display = "block";
      hintBtn.disabled = true;
      hintDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    });

    // === Submit flow ===
    submitBtn.addEventListener("click", () => {
      if (!gameActive) {
        startGame();
        return;
      }
      const values = getInputValues();
      const expectedLen = pyramid[currentStep];
      if (values.length !== expectedLen || values.some(v => v === "")) {
        alert("Please complete this guess.");
        return;
      }

      evaluate(values);
      currentStep++;

      if (currentStep < pyramid.length) {
        renderQuestion();
      } else {
        clearInterval(timerInterval);
        const guess = values.map(val => isNaN(val) ? val : Number(val));
        isCorrect = guess.every((d, i) => d === code[i]);
        totalTime = getElapsedSeconds();
        const minutes = Math.floor(totalTime / 60);
        const seconds = totalTime % 60;
        gameOverDiv.style.display = 'block';
        gameOverDiv.innerHTML = isCorrect
          ? `ð You cracked the code in ${minutes}:${seconds.toString().padStart(2, '0')}`
          : `â Incorrect. The code was ${code.join("")}`;

        submitBtn.disabled = true;

        if (isCorrect) {
          if (totalTime <= 60) stars++;
          stars += correctCount;
          starsDiv.textContent = `â­ Stars: ${stars}`;
          updateStreakOnWin();
          showShareButtons();
        } else {
          stars = 0;
        }

        gameActive = false;
        submitBtn.textContent = "Start Game";
        submitBtn.disabled = false;
      }
    });

    function startGame() {
      if (timerInterval) {
        clearInterval(timerInterval);
      }
      initGame();
      setMenuOpen(false);
      startTime = new Date();
      timerInterval = setInterval(updateTimer, 1000);
      gameActive = true;
      submitBtn.textContent = "Submit Guess";
      renderQuestion();
    }

    // Optional: keep focused cell visible on mobile when keyboard opens
    document.addEventListener('focusin', (e) => {
      if (e.target.classList?.contains('cell')) {
        e.target.scrollIntoView({ block: 'center', behavior: 'smooth' });
      }
    });
  </script>
</body>
</html>



























































