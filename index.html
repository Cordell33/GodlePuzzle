<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>G√∂dle</title>
  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: #121212; 
      color: #eee; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      padding: 2rem;
      margin: 0;
      min-height: 100vh;
    }
    h1 { 
      font-size: 2.8rem; 
      margin-bottom: 1rem; 
      color: #00bcd4;
      text-shadow: 0 0 10px rgba(0, 188, 212, 0.5);
    }
    .game-area { 
      display: flex; 
      align-items: flex-start; 
      gap: 2rem; 
      flex-wrap: wrap; 
      justify-content: center; 
      margin: 1rem 0;
    }
    .questions { 
      font-size: 1.2rem; 
      min-width: 280px; 
      display: flex; 
      flex-direction: column; 
      gap: 1rem; 
    }
    .question-container { 
      display: flex; 
      align-items: center; 
      gap: 0.5rem; 
    }
    .question-text { 
      background-color: #333; 
      border-left: 4px solid #00bcd4; 
      padding: 0.8rem; 
      font-weight: bold; 
      border-radius: 4px; 
      flex-grow: 1;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }
    .question-result { 
      font-size: 1.8rem; 
      min-width: 40px;
      text-align: center;
    }
    .hint-text { 
      background-color: #333; 
      border-left: 4px solid #ff9800; 
      padding: 0.8rem; 
      font-style: italic; 
      border-radius: 4px; 
      margin-top: 1rem; 
      display: none;
      animation: fadeIn 0.5s ease-in;
    }
    .guesses { 
      display: flex; 
      flex-direction: column; 
      align-items: flex-start; 
      width: 100%; 
      max-width: 20rem; 
    }
    .row { 
      display: flex; 
      margin: 0.5rem 0; 
      justify-content: flex-start; 
      align-items: center; 
    }
    .cell { 
      width: 3rem; 
      height: 3rem; 
      font-size: 1.5rem; 
      margin: 0.2rem; 
      text-align: center; 
      border: 2px solid #444; 
      border-radius: 8px; 
      background: #222; 
      color: white;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    .cell:focus {
      outline: none;
      border-color: #00bcd4;
      box-shadow: 0 0 10px rgba(0, 188, 212, 0.5);
    }
    .cell.green { 
      background: #2ecc71; 
      border-color: #27ae60;
      transform: scale(1.05);
    }
    .cell.yellow { 
      background: #f39c12; 
      border-color: #d35400;
      transform: scale(1.05);
    }
    .cell.gray { 
      background: #7f8c8d; 
      border-color: #636e72;
    }
    /* Final code row gets a red border */
    .row.final-code .cell {
      border: 2px solid #27ae60;
      box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
    }

    #submit, #hint-button { 
      margin-top: 1.5rem; 
      padding: 0.8rem 1.5rem; 
      font-size: 1.1rem; 
      width: 100%; 
      max-width: 300px; 
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    #submit {
      background: #00bcd4;
      color: white;
    }
    #submit:hover {
      background: #0097a7;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    #hint-button {
      background: #ff9800;
      color: white;
    }
    #hint-button:hover {
      background: #f57c00;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    #game-over { 
      margin-top: 1.5rem; 
      font-size: 1.5rem; 
      text-align: center;
      padding: 1rem;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.1);
      animation: fadeIn 0.5s ease-in;
      display: none; /* hidden until end */
    }
    #start-screen { 
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0; 
      background: #121212; 
      color: #eee; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      justify-content: center; 
      text-align: center; 
      padding: 2rem; 
      z-index: 999;
      animation: fadeIn 0.5s ease-in;
    }
    #start-button { 
      margin-top: 2rem; 
      padding: 1rem 2rem; 
      font-size: 1.3rem; 
      cursor: pointer; 
      background: #00bcd4;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    #start-button:hover {
      background: #0097a7;
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    }
    #timer { 
      margin-top: 1rem; 
      font-size: 1.3rem; 
      color: #00bcd4;
      font-weight: bold;
    }
    #stars { 
      margin-top: 1rem; 
      font-size: 1.8rem; 
      color: gold;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }
    .share-buttons { 
      display: flex; 
      gap: 1rem; 
      margin-top: 1.5rem; 
      justify-content: center; 
      flex-wrap: wrap; 
    }
    .share-button { 
      padding: 0.8rem 1.5rem; 
      border-radius: 8px; 
      border: none; 
      cursor: pointer; 
      font-size: 1rem; 
      display: flex; 
      align-items: center; 
      gap: 0.5rem; 
      font-weight: bold;
      transition: all 0.3s ease;
    }
    .share-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    .share-button.twitter { background: #1DA1F2; color: white; }
    .share-button.facebook { background: #4267B2; color: white; }
    .share-button.copy { background: #333; color: white; }
    #copy-message { 
      margin-top: 1rem; 
      color: #00bcd4; 
      display: none;
      animation: fadeIn 0.5s ease-in;
    }
    #share-results { 
      margin-top: 2rem; 
      display: none; 
      text-align: center;
      animation: fadeIn 0.5s ease-in;
    }
    footer { 
      margin-top: 3rem; 
      font-size: 0.9rem; 
      color: #777; 
      text-align: center; 
      padding: 1.5rem;
      border-top: 1px solid #333;
      width: 100%;
      max-width: 600px;
    }
    footer a {
      color: #00bcd4;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    footer a:hover {
      color: #ff9800;
      text-decoration: underline;
    }
    @media (max-width: 600px) {
      body { padding: 1rem; }
      .cell { width: 2.8rem; height: 2.8rem; font-size: 1.3rem; }
      .game-area { flex-direction: column; align-items: center; }
      .questions { min-width: 100%; }
      h1 { font-size: 2.2rem; }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background-color: #f39c12;
      opacity: 0.7;
      animation: confetti-fall 5s linear forwards;
      z-index: 1000;
    }
    
    @keyframes confetti-fall {
      0% {
        transform: translateY(-100px) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div id="start-screen">
    <h1>Welcome to G√∂dle</h1>
    <p>A puzzle that uses logic and math to crack a daily code</p>
    <ul style="text-align: left; max-width: 500px;">
      <li>Answer 4 questions using every digit (0-9) <b>once</b>.</li>
      <li>This will help determine what the final code is.</li>
      <li>Green = correct digit & position, Yellow = correct digit, wrong position.</li>
      <li>See how fast you can get it.</li>
      <li>Answer in under a minute for an extra star.</li>
      <li>Share this with your friends.</li>
      <li>Good Luck!</li>
    </ul>
    <button id="start-button">Start Game</button>
  </div>

  <div id="auth-bar" style="width:100%;max-width:680px;display:flex;justify-content:space-between;align-items:center;margin:0.5rem 0 0.25rem;">
    <div id="user-info">Guest</div>
    <div id="streak" title="Daily streak">üî• 0-day streak</div>
  </div>

  <h1>G√∂dle</h1>

  <div id="timer">‚è± Time: 0:00</div>
  <div class="game-area">
    <div class="questions" id="questions"></div>
    <div class="guesses" id="guess-container"></div>
  </div>
  <button id="submit">Submit Guess</button>
  <button id="hint-button" style="display: none;">Hint</button>
  <div id="hint" class="hint-text"></div>
  <div id="stars"></div>
  <div id="game-over" aria-live="polite"></div>

  <div id="share-results">
    <h3>Share Your Results</h3>
    <div class="share-buttons">
      <button class="share-button twitter" onclick="shareTwitter()" aria-label="Share results to Twitter">X/Twitter</button>
      <button class="share-button facebook" onclick="shareFacebook()" aria-label="Share results to Facebook">Facebook</button>
      <button class="share-button copy" onclick="copyResults()" aria-label="Copy results to clipboard">Copy Link</button>
    </div>
    <div id="copy-message" aria-live="polite">Copied to clipboard!</div>
  </div>

  <footer>created by Cordell Booth ‚Ä¢ <a href="https://patreon.com/GodleCreator" target="_blank">Donate</a> ‚Ä¢ <a href="https://www.facebook.com/groups/2109717096181882" target="_blank">Community</a></footer>

  <script>
    // ====== PUZZLE CONTENT ======

   const questions = [
"49 √∑ 7 = ?",
  "18 * (6 √∑ 3) = ?",
  "The square of 22, plus 7 = ?.",
  "58 * 1000 + 2  = ? ",
  "Enter the final 5-digit code"
];

const correctAnswers = [
  [7],          // Q1
  [3, 6],       // Q2
  [4, 9, 1],    // Q3
  [5, 8, 0, 2], // Q4
  [3, 9, 0, 2, 7] // Final code
];

const hintText = "7,36,491,5802.";
const pyramid = [1, 2, 3, 4, 5];
let code = [3, 9, 0, 2, 7];

    // ====== GAME STATE & DOM ======
    let currentStep = 0;
    const questionsDiv = document.getElementById("questions");
    const guessContainer = document.getElementById("guess-container");
    const submitBtn = document.getElementById("submit"); // FIX: define before use
    const hintBtn = document.getElementById("hint-button");
    const gameOverDiv = document.getElementById("game-over");
    const starsDiv = document.getElementById("stars");
    const startScreen = document.getElementById("start-screen");
    const startButton = document.getElementById("start-button");
    const timerDiv = document.getElementById("timer");
    const hintDiv = document.getElementById("hint");
    const shareResults = document.getElementById("share-results");
    const streakEl = document.getElementById("streak");
    const userInfo = document.getElementById("user-info");

    let startTime;
    let timerInterval;
    let questionElements = [];
    let stars = 0;
    let correctCount = 0;
    let totalTime = 0;
    let isCorrect = false;

    // ===== DAILY STREAK (LocalStorage only) =====
    function todayKey(tz = "America/New_York") {
      return new Intl.DateTimeFormat('en-CA', { timeZone: tz, year: 'numeric', month: '2-digit', day: '2-digit'}).format(new Date());
    }
    function daysBetween(d1, d2) {
      const a = new Date(`${d1}T00:00:00Z`), b = new Date(`${d2}T00:00:00Z`);
      return Math.round((b - a) / 86400000);
    }
    function readLocalStreak() {
      try { return JSON.parse(localStorage.getItem("godle_streak")) || { current:0, best:0, last:"" }; }
      catch { return { current:0, best:0, last:"" }; }
    }
    function writeLocalStreak(data) {
      localStorage.setItem("godle_streak", JSON.stringify(data));
    }
    function renderStreak(s) {
      const current = s?.current || 0; const best = s?.best || 0;
      const t = current === 1 ? "day" : "days";
      streakEl.textContent = `üî• ${current}-${t} streak (best ${best})`;
    }
    function updateStreakOnWin() {
      const today = todayKey();
      let s = readLocalStreak();
      if (!s.last) {
        s.current = 1; s.best = 1; s.last = today;
      } else if (s.last === today) {
        // already counted today ‚Äî do nothing
      } else {
        const gap = daysBetween(s.last, today);
        if (gap === 1) s.current += 1;
        else if (gap > 1) s.current = 1;
        s.best = Math.max(s.best, s.current);
        s.last = today;
      }
      writeLocalStreak(s);
      renderStreak(s);
    }
    // Initial render from localStorage on load
    renderStreak(readLocalStreak());

    // ===== INIT =====
    function initGame() {
      questionsDiv.innerHTML = '';
      guessContainer.innerHTML = '';
      gameOverDiv.innerHTML = '';
      gameOverDiv.style.display = 'none';
      starsDiv.innerHTML = '';
      shareResults.style.display = 'none';
      currentStep = 0;
      stars = 0;
      correctCount = 0;
      totalTime = 0;
      isCorrect = false;
      submitBtn.disabled = false;
      hintBtn.disabled = false;
      hintDiv.style.display = 'none';
      timerDiv.textContent = '‚è± Time: 0:00';
    }

    function updateTimer() {
      const now = new Date();
      const elapsed = Math.floor((now - startTime) / 1000);
      const minutes = Math.floor(elapsed / 60);
      const seconds = elapsed % 60;
      timerDiv.textContent = `‚è± Time: ${minutes}:${seconds.toString().padStart(2, '0')}`;
    }
    
    function getElapsedSeconds() { 
      return Math.floor((new Date() - startTime) / 1000); 
    }

    function renderQuestion() {
      const questionContainer = document.createElement("div");
      questionContainer.className = "question-container";

      const questionText = document.createElement("div");
      questionText.className = "question-text";
      questionText.textContent = questions[currentStep];
      questionContainer.appendChild(questionText);

      const resultSpan = document.createElement("div");
      resultSpan.className = "question-result";
      resultSpan.id = `result-${currentStep}`;
      questionContainer.appendChild(resultSpan);

      questionsDiv.appendChild(questionContainer);
      questionElements.push(questionContainer);

      const rowDiv = document.createElement("div");
      rowDiv.className = "row";
      for (let i = 0; i < pyramid[currentStep]; i++) {
        const input = document.createElement("input");
        // Add special class for final code row
        if (currentStep === pyramid.length - 1) {
  rowDiv.classList.add("final-code");
          }
        input.className = "cell active";
        input.maxLength = 1;
        input.type = "text";
        input.inputMode = "numeric";
        input.setAttribute('inputmode','numeric');
        input.setAttribute('pattern','\\d');
        input.addEventListener("input", (e) => {
          e.target.value = e.target.value.replace(/\D/g, '').slice(0,1);
          if (e.target.value.length === 1 && i < pyramid[currentStep] - 1) {
            rowDiv.children[i + 1].focus();
          }
        });
        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter") submitBtn.click();
          if ((e.key === "Backspace" || e.key === "Delete") && e.target.value === "" && i > 0) {
            rowDiv.children[i - 1].focus();
          }
        });
        rowDiv.appendChild(input);
      }
      
      guessContainer.appendChild(rowDiv);
      if (rowDiv.firstChild) rowDiv.firstChild.focus();

      // Show hint button only on final question
      hintBtn.style.display = currentStep === pyramid.length - 1 ? "block" : "none";
      hintDiv.style.display = "none";
    }

    function getInputValues() {
      const activeInputs = document.querySelectorAll(".cell.active");
      return Array.from(activeInputs).map(input => input.value.trim());
    }

    // Wordle-style duplicate handling
    function colorFeedback(guess, codeArr) {
      const res = Array(guess.length).fill('gray');
      const counts = {};
      codeArr.forEach((d) => { counts[d] = (counts[d] || 0) + 1; });
      // pass 1: greens
      guess.forEach((d,i) => {
        if (codeArr[i] === d) { res[i] = 'green'; counts[d]--; }
      });
      // pass 2: yellows
      guess.forEach((d,i) => {
        if (res[i] === 'gray' && counts[d] > 0) { res[i] = 'yellow'; counts[d]--; }
      });
      return res;
    }

    function evaluate(inputArr) {
      const inputDigits = inputArr.map(val => isNaN(val) ? val : Number(val));
      isCorrect = inputDigits.every((val, i) =>
        val === correctAnswers[currentStep][i] ||
        (typeof val === 'string' && val.toUpperCase() === String(correctAnswers[currentStep][i]).toUpperCase())
      );

      const resultSpan = document.getElementById(`result-${currentStep}`);
      resultSpan.textContent = isCorrect ? "‚úÖ" : "‚ùå";
      if (isCorrect && currentStep < 4) { correctCount++; }

      const feedback = colorFeedback(inputDigits, code);
      const activeInputs = document.querySelectorAll(".cell.active");
      activeInputs.forEach((input, i) => { 
        input.classList.remove("active"); 
        input.classList.add(feedback[i]); 
        input.disabled = true; 
      });
    }

    function showShareButtons() { shareResults.style.display = "block"; }

    function shareTwitter() {
      window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(buildShareText())}`, '_blank', 'noopener');
    }
    function shareFacebook() {
      const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}`;
      const win = window.open(shareUrl, 'fb-share-dialog', 'width=626,height=436');
      if (!win) { copyResults(); alert('Facebook share popup was blocked. Your results were copied‚Äîpaste into Facebook manually.'); }
    }

    function buildShareText() {
      const minutes = Math.floor(totalTime / 60);
      const seconds = totalTime % 60;
      let grid = "";
      const inputs = document.querySelectorAll(".cell");
      let index = 0;
      for (let r = 0; r < pyramid.length - 1; r++) {
        let row = "";
        for (let c = 0; c < pyramid[r]; c++) {
          const cell = inputs[index++];
          if (cell && cell.classList.contains("green")) row += "üü©";
          else if (cell && cell.classList.contains("yellow")) row += "üü®";
          else row += "‚¨õ";
        }
        grid += (r > 0 ? "\n" : "") + row;
      }
      return `G√∂dle - I solved it in ${minutes}:${seconds.toString().padStart(2,'0')} with ${stars} stars! ‚≠ê\n${grid}\n\nTry it yourself: ${window.location.href}`;
    }

    async function copyResults() {
      const text = buildShareText();
      try {
        await navigator.clipboard.writeText(text);
        document.getElementById("copy-message").style.display = "block";
        setTimeout(() => { document.getElementById("copy-message").style.display = "none"; }, 2000);
      } catch (err) {
        const ta = document.createElement('textarea');
        ta.value = text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
        document.getElementById("copy-message").style.display = "block";
        setTimeout(() => { document.getElementById("copy-message").style.display = "none"; }, 2000);
      }
    }

    // === Hint button ===
    hintBtn.addEventListener("click", () => {
      hintDiv.textContent = hintText;
      hintDiv.style.display = "block";
      hintBtn.disabled = true;
      hintDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    });

    // === Submit flow ===
    submitBtn.addEventListener("click", () => {
      const values = getInputValues();
      const expectedLen = pyramid[currentStep];
      if (values.length !== expectedLen || values.some(v => v === "")) {
        alert("Please complete this guess.");
        return;
      }

      evaluate(values);
      currentStep++;

      if (currentStep < pyramid.length) {
        renderQuestion();
      } else {
        clearInterval(timerInterval);
        const guess = values.map(val => isNaN(val) ? val : Number(val));
        isCorrect = guess.every((d, i) => d === code[i]);
        totalTime = getElapsedSeconds();
        const minutes = Math.floor(totalTime / 60);
        const seconds = totalTime % 60;
        gameOverDiv.style.display = 'block';
        gameOverDiv.innerHTML = isCorrect
          ? `üéâ You cracked the code in ${minutes}:${seconds.toString().padStart(2, '0')}`
          : `‚ùå Incorrect. The code was ${code.join("")}`;

        submitBtn.disabled = true;

        if (isCorrect) {
          if (totalTime <= 60) stars++;
          stars += correctCount;
          starsDiv.textContent = `‚≠ê Stars: ${stars}`;
          updateStreakOnWin();
          showShareButtons();
        } else {
          stars = 0;
        }
      }
    });

    // === Start ===
    startButton.addEventListener("click", () => {
      startScreen.style.display = "none";
      startTime = new Date();
      timerInterval = setInterval(updateTimer, 1000);
      initGame();
      renderQuestion();
    });

    // Optional: keep focused cell visible on mobile when keyboard opens
    document.addEventListener('focusin', (e) => {
      if (e.target.classList?.contains('cell')) {
        e.target.scrollIntoView({ block: 'center', behavior: 'smooth' });
      }
    });
  </script>
</body>
</html>

























